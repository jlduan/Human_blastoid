<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-99.9.9">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Jialei Duan">
<title>Human blastoid - Single Cell Transcriptomes of Human Blastoids</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./compare_blastoids.html" rel="next">
<link href="./cluster_blastoids.html" rel="prev">
<link href="./logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-SKHX1FQV8F"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-SKHX1FQV8F', { 'anonymize_ip': true});
</script><link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Human blastoid - Single Cell Transcriptomes of Human Blastoids">
<meta property="og:description" content="Human blastoids provide a readily accessible, scalable, versatile and perturbable alternative to blastocysts for studying early human development, understanding early pregnancy loss and gaining…">
<meta property="og:image" content="https://jlduan.github.io/Human_blastoid/docs/schematic_summary.png">
<meta property="og:site-name" content="Human_blastoid">
<meta name="twitter:title" content="Blastocyst-like structures generated from human pluripotent stem cells">
<meta name="twitter:description" content="Human blastoids provide a readily accessible, scalable, versatile and perturbable alternative to blastocysts for studying early human development, understanding early pregnancy loss and gaining…">
<meta name="twitter:image" content="https://jlduan.github.io/Human_blastoid/docs/schematic_summary.png">
<meta name="twitter:creator" content="@jlduan">
<meta name="twitter:card" content="summary_large_image">
<meta name="citation_title" content="Blastocyst-like structures generated from human pluripotent stem cells">
<meta name="citation_abstract" content="Human blastoids provide a readily accessible, scalable, versatile and perturbable alternative to blastocysts for studying early human development, understanding early pregnancy loss and gaining insights into early developmental defects.
">
<meta name="citation_author" content="Leqian Yu">
<meta name="citation_author" content="Yulei Wei">
<meta name="citation_author" content="Jialei Duan">
<meta name="citation_author" content="Daniel A. Schmitz">
<meta name="citation_author" content="Masahiro Sakurai">
<meta name="citation_author" content="Lei Wang">
<meta name="citation_author" content="Kunhua Wang">
<meta name="citation_author" content="Shuhua Zhao">
<meta name="citation_author" content="Gary C. Hon">
<meta name="citation_author" content="Jun Wu">
<meta name="citation_publication_date" content="2022-09-24">
<meta name="citation_cover_date" content="2022-09-24">
<meta name="citation_year" content="2022">
<meta name="citation_online_date" content="2022-03-17">
<meta name="citation_fulltext_html_url" content="https://doi.org/10.1038/s41586-021-03356-y">
<meta name="citation_issue" content="7851">
<meta name="citation_doi" content="10.1038/s41586-021-03356-y">
<meta name="citation_pmid" content="33731924">
<meta name="citation_volume" content="591">
<meta name="citation_language" content="en">
<meta name="citation_firstpage" content="620">
<meta name="citation_lastpage" content="626">
<meta name="citation_journal_title" content="Nature">
<meta name="citation_publisher" content="Nature Publishing Group">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Single Cell Transcriptomes of Human Blastoids</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-center sidebar-header sidebar-header-stacked">
      <a href="./" class="sidebar-logo-link">
      <img src="./logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none"></a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./"><strong>Human blastoid</strong></a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/jlduan" title="Human blastoid" class="sidebar-tool px-1"><i class="bi bi-globe"></i></a>
    <a href="" title="GitHub" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-github"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
<li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/jlduan/Human_blastoid">
          Source Code
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://github.com/jlduan/Human_blastoid/issues">
          Report a Bug
          </a>
        </li>
    </ul>
<a href="https://twitter.com/jlduan" title="Twitter" class="sidebar-tool px-1"><i class="bi bi-twitter"></i></a>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Welcome</a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preprocess_matrices.html" class="sidebar-item-text sidebar-link">Preprocess</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cluster_blastoids.html" class="sidebar-item-text sidebar-link">Cluster</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analyze_blastoids.html" class="sidebar-item-text sidebar-link active">Interpret</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./compare_blastoids.html" class="sidebar-item-text sidebar-link">Compare</a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./miscellaneous.html" class="sidebar-item-text sidebar-link">Miscellaneous</a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#preparation" id="toc-preparation" class="nav-link active" data-scroll-target="#preparation">Preparation</a>
  <ul>
<li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions">Functions</a></li>
  <li><a href="#python-env" id="toc-python-env" class="nav-link" data-scroll-target="#python-env">Python env</a></li>
  <li><a href="#matrix" id="toc-matrix" class="nav-link" data-scroll-target="#matrix">Matrix</a></li>
  <li><a href="#embedding" id="toc-embedding" class="nav-link" data-scroll-target="#embedding">Embedding</a></li>
  <li><a href="#metadata" id="toc-metadata" class="nav-link" data-scroll-target="#metadata">Metadata</a></li>
  </ul>
</li>
  <li>
<a href="#blastoids-globally-resemble-blastocysts" id="toc-blastoids-globally-resemble-blastocysts" class="nav-link" data-scroll-target="#blastoids-globally-resemble-blastocysts">Blastoids globally resemble blastocysts</a>
  <ul>
<li>
<a href="#embedding-visualization" id="toc-embedding-visualization" class="nav-link" data-scroll-target="#embedding-visualization">Embedding visualization</a>
  <ul class="collapse">
<li><a href="#clustering-batch-umi" id="toc-clustering-batch-umi" class="nav-link" data-scroll-target="#clustering-batch-umi">Clustering &amp; batch &amp; UMI</a></li>
  <li><a href="#developmental-stages" id="toc-developmental-stages" class="nav-link" data-scroll-target="#developmental-stages">Developmental stages</a></li>
  <li><a href="#polishing" id="toc-polishing" class="nav-link" data-scroll-target="#polishing">Polishing</a></li>
  </ul>
</li>
  <li>
<a href="#expression" id="toc-expression" class="nav-link" data-scroll-target="#expression">Expression</a>
  <ul class="collapse">
<li><a href="#embedding-1" id="toc-embedding-1" class="nav-link" data-scroll-target="#embedding-1">Embedding</a></li>
  <li><a href="#lollipop" id="toc-lollipop" class="nav-link" data-scroll-target="#lollipop">Lollipop</a></li>
  <li><a href="#violin" id="toc-violin" class="nav-link" data-scroll-target="#violin">Violin</a></li>
  </ul>
</li>
  <li><a href="#cluster-composition" id="toc-cluster-composition" class="nav-link" data-scroll-target="#cluster-composition">Cluster composition</a></li>
  <li><a href="#heatmap-construction" id="toc-heatmap-construction" class="nav-link" data-scroll-target="#heatmap-construction">Heatmap construction</a></li>
  <li><a href="#gene-ontology-enrichment" id="toc-gene-ontology-enrichment" class="nav-link" data-scroll-target="#gene-ontology-enrichment">Gene Ontology enrichment</a></li>
  </ul>
</li>
  <li>
<a href="#high-concordance-of-blastoid-replicates" id="toc-high-concordance-of-blastoid-replicates" class="nav-link" data-scroll-target="#high-concordance-of-blastoid-replicates">High concordance of blastoid replicates</a>
  <ul>
<li><a href="#data-loading" id="toc-data-loading" class="nav-link" data-scroll-target="#data-loading">Data loading</a></li>
  <li>
<a href="#embedding-visualization-1" id="toc-embedding-visualization-1" class="nav-link" data-scroll-target="#embedding-visualization-1">Embedding visualization</a>
  <ul class="collapse">
<li><a href="#clustering-batch-umi-1" id="toc-clustering-batch-umi-1" class="nav-link" data-scroll-target="#clustering-batch-umi-1">Clustering &amp; batch &amp; UMI</a></li>
  </ul>
</li>
  <li><a href="#cluster-composition-1" id="toc-cluster-composition-1" class="nav-link" data-scroll-target="#cluster-composition-1">Cluster composition</a></li>
  </ul>
</li>
  <li>
<a href="#blastoids-derived-stem-cell-lines" id="toc-blastoids-derived-stem-cell-lines" class="nav-link" data-scroll-target="#blastoids-derived-stem-cell-lines">Blastoids derived stem cell lines</a>
  <ul>
<li><a href="#data-loading-1" id="toc-data-loading-1" class="nav-link" data-scroll-target="#data-loading-1">Data loading</a></li>
  <li>
<a href="#embedding-visualization-2" id="toc-embedding-visualization-2" class="nav-link" data-scroll-target="#embedding-visualization-2">Embedding visualization</a>
  <ul class="collapse">
<li><a href="#clustering-batch-umi-2" id="toc-clustering-batch-umi-2" class="nav-link" data-scroll-target="#clustering-batch-umi-2">Clustering &amp; batch &amp; UMI</a></li>
  <li><a href="#polishing-1" id="toc-polishing-1" class="nav-link" data-scroll-target="#polishing-1">Polishing</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#trajectory-inference" id="toc-trajectory-inference" class="nav-link" data-scroll-target="#trajectory-inference">Trajectory inference</a>
  <ul>
<li><a href="#data-loading-2" id="toc-data-loading-2" class="nav-link" data-scroll-target="#data-loading-2">Data loading</a></li>
  <li>
<a href="#embedding-visualization-3" id="toc-embedding-visualization-3" class="nav-link" data-scroll-target="#embedding-visualization-3">Embedding visualization</a>
  <ul class="collapse">
<li><a href="#clustering-batch-umi-3" id="toc-clustering-batch-umi-3" class="nav-link" data-scroll-target="#clustering-batch-umi-3">Clustering &amp; batch &amp; UMI</a></li>
  <li><a href="#polishing-2" id="toc-polishing-2" class="nav-link" data-scroll-target="#polishing-2">Polishing</a></li>
  </ul>
</li>
  <li><a href="#cluster-composition-2" id="toc-cluster-composition-2" class="nav-link" data-scroll-target="#cluster-composition-2">Cluster composition</a></li>
  </ul>
</li>
  <li><a href="#r-session-info" id="toc-r-session-info" class="nav-link" data-scroll-target="#r-session-info">R session info</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title d-none d-lg-block">Single Cell Transcriptomes of Human Blastoids</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jialei Duan <a href="https://orcid.org/0000-0003-4086-7461" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Sat Sep 24, 2022 22:06:15-05:00</p>
    </div>
  </div>
  
    
    <div>
    <div class="quarto-title-meta-heading">Doi</div>
    <div class="quarto-title-meta-contents">
      <p class="doi">
        <a href="https://doi.org/10.5281/zenodo.7110557">10.5281/zenodo.7110557</a>
      </p>
    </div>
  </div>
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstract</div>
    <p>Human blastoids provide a readily accessible, scalable, versatile and perturbable alternative to blastocysts for studying early human development, understanding early pregnancy loss and gaining insights into early developmental defects.</p>
  </div>
</div>

</header><p><br></p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2022-09-24 22:04:31 CDT"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/timezones.html">Sys.timezone</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "America/Chicago"</code></pre>
</div>
</div>
<section id="preparation" class="level2"><h2 class="anchored" data-anchor-id="preparation">Preparation</h2>
<section id="functions" class="level3"><h3 class="anchored" data-anchor-id="functions">Functions</h3>
<div class="cell">

</div>
<p>Load required packages.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org/">Matrix</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/wch/extrafont">extrafont</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span></span>
<span>    file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span></span>
<span>        <span class="va">SCRIPT_DIR</span>,</span>
<span>        <span class="st">"utilities.R"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">load_matrix</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">matrix_readcount_use</span> <span class="op">&lt;-</span> <span class="va">scipy.sparse</span><span class="op">$</span><span class="fu">load_npz</span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"matrix_readcount.npz"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">np</span><span class="op">$</span><span class="fu">load</span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"matrix_readcount_barcodes.npy"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">np</span><span class="op">$</span><span class="fu">load</span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"matrix_readcount_features.npy"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="python-env" class="level3"><h3 class="anchored" data-anchor-id="python-env">Python env</h3>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">np</span> <span class="op">&lt;-</span> <span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/import.html">import</a></span><span class="op">(</span><span class="st">"numpy"</span>, convert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">scipy.sparse</span> <span class="op">&lt;-</span> <span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/import.html">import</a></span><span class="op">(</span>module <span class="op">=</span> <span class="st">"scipy.sparse"</span>, convert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/py_config.html">py_config</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>python:         /Users/jialei/.pyenv/shims/python
libpython:      /Users/jialei/.pyenv/versions/mambaforge-4.10.3-10/lib/libpython3.9.dylib
pythonhome:     /Users/jialei/.pyenv/versions/mambaforge-4.10.3-10:/Users/jialei/.pyenv/versions/mambaforge-4.10.3-10
version:        3.9.13 | packaged by conda-forge | (main, May 27 2022, 17:00:33)  [Clang 13.0.1 ]
numpy:          /Users/jialei/.pyenv/versions/mambaforge-4.10.3-10/lib/python3.9/site-packages/numpy
numpy_version:  1.22.4
numpy:          /Users/jialei/.pyenv/versions/mambaforge-4.10.3-10/lib/python3.9/site-packages/numpy

NOTE: Python version was forced by RETICULATE_PYTHON</code></pre>
</div>
</div>
</section><section id="matrix" class="level3"><h3 class="anchored" data-anchor-id="matrix">Matrix</h3>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">PROJECT_DIR</span> <span class="op">&lt;-</span> <span class="st">"/Users/jialei/Dropbox/Data/Projects/UTSW/Human_blastoid"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MATRIX_DIR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"github/data/matrices/LW36"</span>,</span>
<span>    <span class="st">"github/data/matrices/LW49_LW50_LW51_LW52"</span>,</span>
<span>    <span class="st">"github/data/matrices/LW58_LW59"</span>,</span>
<span>    <span class="st">"github/data/matrices/LW60_LW61"</span>,</span>
<span>    <span class="st">"raw/public/PRJEB11202/reformatted_matrix"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">matrix_readcount_use</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">MATRIX_DIR</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">load_matrix</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">PROJECT_DIR</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">cbind</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># clean up</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">MATRIX_DIR</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="embedding" class="level3"><h3 class="anchored" data-anchor-id="embedding">Embedding</h3>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">EMBEDDING_FILE</span> <span class="op">&lt;-</span> <span class="st">"embedding.csv.gz"</span></span>
<span></span>
<span><span class="va">embedding</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span></span>
<span>    file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span></span>
<span>        <span class="va">PROJECT_DIR</span>,</span>
<span>        <span class="st">"github"</span>,</span>
<span>        <span class="st">"data"</span>,</span>
<span>        <span class="va">EMBEDDING_FILE</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># clean up</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">EMBEDDING_FILE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="metadata" class="level3"><h3 class="anchored" data-anchor-id="metadata">Metadata</h3>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cell_metadata_PRJEB11202</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span></span>
<span>        <span class="va">PROJECT_DIR</span>,</span>
<span>        <span class="st">"raw/public/PRJEB11202/"</span>,</span>
<span>        <span class="st">"E-MTAB-3929.sdrf.tsv"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    delim <span class="op">=</span> <span class="st">"\t"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>        <span class="va">`Comment[ENA_SAMPLE]`</span>,</span>
<span>        <span class="va">`Comment[ENA_RUN]`</span>,</span>
<span>        <span class="va">`Characteristics[developmental stage]`</span>,</span>
<span>        <span class="va">`Characteristics[inferred lineage]`</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span></span>
<span>        cell <span class="op">=</span> <span class="va">`Comment[ENA_SAMPLE]`</span>,</span>
<span>        run <span class="op">=</span> <span class="va">`Comment[ENA_RUN]`</span>,</span>
<span>        developmental_stage <span class="op">=</span> <span class="va">`Characteristics[developmental stage]`</span>,</span>
<span>        lineage <span class="op">=</span> <span class="va">`Characteristics[inferred lineage]`</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        developmental_stage <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span></span>
<span>            string <span class="op">=</span> <span class="va">developmental_stage</span>,</span>
<span>            pattern <span class="op">=</span> <span class="st">"embryonic day "</span>,</span>
<span>            replacement <span class="op">=</span> <span class="st">"E"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        lineage <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">lineage</span> <span class="op">==</span> <span class="st">"epiblast"</span> <span class="op">~</span> <span class="st">"EPI"</span>,</span>
<span>            <span class="va">lineage</span> <span class="op">==</span> <span class="st">"primitive endoderm"</span> <span class="op">~</span> <span class="st">"HYP"</span>,</span>
<span>            <span class="va">lineage</span> <span class="op">==</span> <span class="st">"trophectoderm"</span> <span class="op">~</span> <span class="st">"TE"</span>,</span>
<span>            <span class="va">lineage</span> <span class="op">==</span> <span class="st">"not applicable"</span> <span class="op">~</span> <span class="st">"Pre-lineage"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">embedding</span> <span class="op">&lt;-</span> <span class="va">embedding</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span></span>
<span>        <span class="va">cell_metadata_PRJEB11202</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        developmental_stage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">developmental_stage</span><span class="op">)</span>,</span>
<span>        lineage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">lineage</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<div class="cell">

</div>
<p><br></p>
<p>Check memory usage.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">walk</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">matrix_readcount_use</span>, <span class="va">embedding</span><span class="op">)</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"auto"</span>, standard <span class="op">=</span> <span class="st">"SI"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>496.5 MB
1.6 MB</code></pre>
</div>
</div>
</section></section><section id="blastoids-globally-resemble-blastocysts" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="blastoids-globally-resemble-blastocysts">Blastoids globally resemble blastocysts</h2>
<section id="embedding-visualization" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="embedding-visualization">Embedding visualization</h3>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">EMBEDDING_TITLE_PREFIX</span> <span class="op">&lt;-</span> <span class="st">"UMAP"</span></span>
<span></span>
<span><span class="va">x_column</span> <span class="op">&lt;-</span> <span class="st">"x_umap"</span></span>
<span><span class="va">y_column</span> <span class="op">&lt;-</span> <span class="st">"y_umap"</span></span>
<span></span>
<span><span class="va">GEOM_POINT_SIZE</span> <span class="op">&lt;-</span> <span class="fl">0.6</span></span>
<span><span class="va">RASTERISED</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="clustering-batch-umi" class="level4"><h4 class="anchored" data-anchor-id="clustering-batch-umi">Clustering &amp; batch &amp; UMI</h4>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p_embedding_louvain</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="va">embedding</span><span class="op">$</span><span class="va">louvain</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{EMBEDDING_TITLE_PREFIX}; Cluster"</span><span class="op">)</span>,</span>
<span>    color_labels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    shuffle_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="va">GEOM_POINT_SIZE</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_embedding_batch</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="va">embedding</span><span class="op">$</span><span class="va">batch</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{EMBEDDING_TITLE_PREFIX}; Batch"</span><span class="op">)</span>,</span>
<span>    color_labels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    shuffle_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="va">GEOM_POINT_SIZE</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_embedding_UMI</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html">colSums</a></span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">embedding</span><span class="op">$</span><span class="va">cell</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{EMBEDDING_TITLE_PREFIX}; UMI"</span><span class="op">)</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    shuffle_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="va">GEOM_POINT_SIZE</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">selected_feature</span> <span class="op">&lt;-</span> <span class="st">"ENSG00000204531_POU5F1"</span></span>
<span><span class="va">p_embedding_POU5F1</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span></span>
<span>        <span class="fu">calc_cpm</span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">embedding</span><span class="op">$</span><span class="va">cell</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="op">[</span><span class="va">selected_feature</span>, <span class="op">]</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span></span>
<span>        <span class="st">"{EMBEDDING_TITLE_PREFIX}; "</span>,</span>
<span>        <span class="st">"{selected_feature |&gt; stringr::str_remove(pattern = \"^E.+_\")}"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="va">GEOM_POINT_SIZE</span>,</span>
<span>    na_value <span class="op">=</span> <span class="st">"grey80"</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">embedding</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        num_umis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html">colSums</a></span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">cell</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        num_features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html">colSums</a></span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">cell</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">louvain</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>        num_cells <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        median_umis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">num_umis</span><span class="op">)</span>,</span>
<span>        median_features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">num_features</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/data_color.html">data_color</a></span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">median_umis</span><span class="op">)</span>,</span>
<span>        colors <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/col_numeric.html">col_numeric</a></span><span class="op">(</span></span>
<span>            palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                <span class="st">"green"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span></span>
<span>            <span class="op">)</span>,</span>
<span>            domain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">32000</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/summary_rows.html">summary_rows</a></span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">louvain</span><span class="op">)</span>,</span>
<span>        fns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>            Count <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        decimals <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/summary_rows.html">summary_rows</a></span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">median_umis</span><span class="op">:</span><span class="va">median_features</span><span class="op">)</span>,</span>
<span>        fns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>            Mean <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        decimals <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/summary_rows.html">summary_rows</a></span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">num_cells</span><span class="op">)</span>,</span>
<span>        fns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>            Sum <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        decimals <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/tab_header.html">tab_header</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/md.html">md</a></span><span class="op">(</span><span class="st">"**Blastoid Clustering**; Cluster"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="gtjbaqnfqx" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

:where(#gtjbaqnfqx) .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

:where(#gtjbaqnfqx) .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#gtjbaqnfqx) .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

:where(#gtjbaqnfqx) .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

:where(#gtjbaqnfqx) .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#gtjbaqnfqx) .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#gtjbaqnfqx) .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

:where(#gtjbaqnfqx) .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

:where(#gtjbaqnfqx) .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

:where(#gtjbaqnfqx) .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

:where(#gtjbaqnfqx) .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

:where(#gtjbaqnfqx) .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

:where(#gtjbaqnfqx) .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

:where(#gtjbaqnfqx) .gt_from_md > :first-child {
  margin-top: 0;
}

:where(#gtjbaqnfqx) .gt_from_md > :last-child {
  margin-bottom: 0;
}

:where(#gtjbaqnfqx) .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

:where(#gtjbaqnfqx) .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#gtjbaqnfqx) .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

:where(#gtjbaqnfqx) .gt_row_group_first td {
  border-top-width: 2px;
}

:where(#gtjbaqnfqx) .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#gtjbaqnfqx) .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

:where(#gtjbaqnfqx) .gt_first_summary_row.thick {
  border-top-width: 2px;
}

:where(#gtjbaqnfqx) .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#gtjbaqnfqx) .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#gtjbaqnfqx) .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

:where(#gtjbaqnfqx) .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

:where(#gtjbaqnfqx) .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#gtjbaqnfqx) .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#gtjbaqnfqx) .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#gtjbaqnfqx) .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#gtjbaqnfqx) .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#gtjbaqnfqx) .gt_left {
  text-align: left;
}

:where(#gtjbaqnfqx) .gt_center {
  text-align: center;
}

:where(#gtjbaqnfqx) .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

:where(#gtjbaqnfqx) .gt_font_normal {
  font-weight: normal;
}

:where(#gtjbaqnfqx) .gt_font_bold {
  font-weight: bold;
}

:where(#gtjbaqnfqx) .gt_font_italic {
  font-style: italic;
}

:where(#gtjbaqnfqx) .gt_super {
  font-size: 65%;
}

:where(#gtjbaqnfqx) .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

:where(#gtjbaqnfqx) .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

:where(#gtjbaqnfqx) .gt_indent_1 {
  text-indent: 5px;
}

:where(#gtjbaqnfqx) .gt_indent_2 {
  text-indent: 10px;
}

:where(#gtjbaqnfqx) .gt_indent_3 {
  text-indent: 15px;
}

:where(#gtjbaqnfqx) .gt_indent_4 {
  text-indent: 20px;
}

:where(#gtjbaqnfqx) .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
<thead class="gt_header"><tr>
<td colspan="5" class="gt_heading gt_title gt_font_normal gt_bottom_border" style="">
<strong>Blastoid Clustering</strong>; Cluster</td>
    </tr></thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=""></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="louvain">louvain</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="num_cells">num_cells</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="median_umis">median_umis</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="median_features">median_features</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<th id="stub_1_1" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_1 louvain" class="gt_row gt_right">0</td>
<td headers="stub_1_1 num_cells" class="gt_row gt_right">1533</td>
<td headers="stub_1_1 median_umis" class="gt_row gt_right" style="background-color: #D6C700; color: #000000;">11534.0</td>
<td headers="stub_1_1 median_features" class="gt_row gt_right">3074.0</td>
</tr>
<tr>
<th id="stub_1_2" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_2 louvain" class="gt_row gt_right">1</td>
<td headers="stub_1_2 num_cells" class="gt_row gt_right">1113</td>
<td headers="stub_1_2 median_umis" class="gt_row gt_right" style="background-color: #FF9B00; color: #000000;">18092.0</td>
<td headers="stub_1_2 median_features" class="gt_row gt_right">3612.0</td>
</tr>
<tr>
<th id="stub_1_3" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_3 louvain" class="gt_row gt_right">2</td>
<td headers="stub_1_3 num_cells" class="gt_row gt_right">1079</td>
<td headers="stub_1_3 median_umis" class="gt_row gt_right" style="background-color: #D4C800; color: #000000;">11308.0</td>
<td headers="stub_1_3 median_features" class="gt_row gt_right">2940.0</td>
</tr>
<tr>
<th id="stub_1_4" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_4 louvain" class="gt_row gt_right">3</td>
<td headers="stub_1_4 num_cells" class="gt_row gt_right">996</td>
<td headers="stub_1_4 median_umis" class="gt_row gt_right" style="background-color: #F1B200; color: #000000;">14659.0</td>
<td headers="stub_1_4 median_features" class="gt_row gt_right">3220.5</td>
</tr>
<tr>
<th id="stub_1_5" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_5 louvain" class="gt_row gt_right">4</td>
<td headers="stub_1_5 num_cells" class="gt_row gt_right">924</td>
<td headers="stub_1_5 median_umis" class="gt_row gt_right" style="background-color: #14FE00; color: #000000;">1108.5</td>
<td headers="stub_1_5 median_features" class="gt_row gt_right">627.0</td>
</tr>
<tr>
<th id="stub_1_6" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_6 louvain" class="gt_row gt_right">5</td>
<td headers="stub_1_6 num_cells" class="gt_row gt_right">725</td>
<td headers="stub_1_6 median_umis" class="gt_row gt_right" style="background-color: #A5E100; color: #000000;">6915.0</td>
<td headers="stub_1_6 median_features" class="gt_row gt_right">1981.0</td>
</tr>
<tr>
<th id="stub_1_7" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_7 louvain" class="gt_row gt_right">6</td>
<td headers="stub_1_7 num_cells" class="gt_row gt_right">710</td>
<td headers="stub_1_7 median_umis" class="gt_row gt_right" style="background-color: #C4D200; color: #000000;">9711.5</td>
<td headers="stub_1_7 median_features" class="gt_row gt_right">2158.0</td>
</tr>
<tr>
<th id="stub_1_8" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_8 louvain" class="gt_row gt_right">7</td>
<td headers="stub_1_8 num_cells" class="gt_row gt_right">672</td>
<td headers="stub_1_8 median_umis" class="gt_row gt_right" style="background-color: #CDCD00; color: #000000;">10544.0</td>
<td headers="stub_1_8 median_features" class="gt_row gt_right">2791.5</td>
</tr>
<tr>
<th id="stub_1_9" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_9 louvain" class="gt_row gt_right">8</td>
<td headers="stub_1_9 num_cells" class="gt_row gt_right">649</td>
<td headers="stub_1_9 median_umis" class="gt_row gt_right" style="background-color: #DAC400; color: #000000;">11961.0</td>
<td headers="stub_1_9 median_features" class="gt_row gt_right">2905.0</td>
</tr>
<tr>
<th id="stub_1_10" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_10 louvain" class="gt_row gt_right">9</td>
<td headers="stub_1_10 num_cells" class="gt_row gt_right">570</td>
<td headers="stub_1_10 median_umis" class="gt_row gt_right" style="background-color: #FF9300; color: #000000;">19201.0</td>
<td headers="stub_1_10 median_features" class="gt_row gt_right">3656.0</td>
</tr>
<tr>
<th id="stub_1_11" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_11 louvain" class="gt_row gt_right">10</td>
<td headers="stub_1_11 num_cells" class="gt_row gt_right">410</td>
<td headers="stub_1_11 median_umis" class="gt_row gt_right" style="background-color: #FF7300; color: #FFFFFF;">23705.5</td>
<td headers="stub_1_11 median_features" class="gt_row gt_right">4208.5</td>
</tr>
<tr>
<th id="stub_1_12" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_12 louvain" class="gt_row gt_right">11</td>
<td headers="stub_1_12 num_cells" class="gt_row gt_right">366</td>
<td headers="stub_1_12 median_umis" class="gt_row gt_right" style="background-color: #EBB700; color: #000000;">13910.5</td>
<td headers="stub_1_12 median_features" class="gt_row gt_right">3355.5</td>
</tr>
<tr>
<th id="stub_1_13" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_13 louvain" class="gt_row gt_right">12</td>
<td headers="stub_1_13 num_cells" class="gt_row gt_right">365</td>
<td headers="stub_1_13 median_umis" class="gt_row gt_right" style="background-color: #FFA200; color: #000000;">16942.0</td>
<td headers="stub_1_13 median_features" class="gt_row gt_right">3437.0</td>
</tr>
<tr>
<th id="stub_1_14" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_14 louvain" class="gt_row gt_right">13</td>
<td headers="stub_1_14 num_cells" class="gt_row gt_right">275</td>
<td headers="stub_1_14 median_umis" class="gt_row gt_right" style="background-color: #B2DB00; color: #000000;">8010.0</td>
<td headers="stub_1_14 median_features" class="gt_row gt_right">2455.0</td>
</tr>
<tr>
<th id="stub_1_15" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_15 louvain" class="gt_row gt_right">14</td>
<td headers="stub_1_15 num_cells" class="gt_row gt_right">249</td>
<td headers="stub_1_15 median_umis" class="gt_row gt_right" style="background-color: #FF0300; color: #FFFFFF;">31950.0</td>
<td headers="stub_1_15 median_features" class="gt_row gt_right">4954.0</td>
</tr>
<tr>
<th id="stub_1_16" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_16 louvain" class="gt_row gt_right">15</td>
<td headers="stub_1_16 num_cells" class="gt_row gt_right">202</td>
<td headers="stub_1_16 median_umis" class="gt_row gt_right" style="background-color: #B4DA00; color: #000000;">8217.0</td>
<td headers="stub_1_16 median_features" class="gt_row gt_right">2452.0</td>
</tr>
<tr>
<th id="stub_1_17" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_17 louvain" class="gt_row gt_right">16</td>
<td headers="stub_1_17 num_cells" class="gt_row gt_right">138</td>
<td headers="stub_1_17 median_umis" class="gt_row gt_right" style="background-color: #CACE00; color: #000000;">10242.5</td>
<td headers="stub_1_17 median_features" class="gt_row gt_right">2852.5</td>
</tr>
<tr>
<th id="stub_1_18" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_18 louvain" class="gt_row gt_right">17</td>
<td headers="stub_1_18 num_cells" class="gt_row gt_right">120</td>
<td headers="stub_1_18 median_umis" class="gt_row gt_right" style="background-color: #FF9F00; color: #000000;">17426.0</td>
<td headers="stub_1_18 median_features" class="gt_row gt_right">3400.0</td>
</tr>
<tr>
<th id="stub_1_19" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_19 louvain" class="gt_row gt_right">18</td>
<td headers="stub_1_19 num_cells" class="gt_row gt_right">86</td>
<td headers="stub_1_19 median_umis" class="gt_row gt_right" style="background-color: #FF9A00; color: #000000;">18158.0</td>
<td headers="stub_1_19 median_features" class="gt_row gt_right">3853.5</td>
</tr>
<tr>
<th id="grand_summary_stub_1" scope="row" class="gt_row gt_left gt_stub gt_grand_summary_row gt_first_grand_summary_row">Count</th>
<td headers="grand_summary_stub_1 louvain" class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row">19</td>
<td headers="grand_summary_stub_1 num_cells" class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row">—</td>
<td headers="grand_summary_stub_1 median_umis" class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row">—</td>
<td headers="grand_summary_stub_1 median_features" class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row">—</td>
</tr>
<tr>
<th id="grand_summary_stub_2" scope="row" class="gt_row gt_left gt_stub gt_grand_summary_row">Mean</th>
<td headers="grand_summary_stub_2 louvain" class="gt_row gt_right gt_grand_summary_row">—</td>
<td headers="grand_summary_stub_2 num_cells" class="gt_row gt_right gt_grand_summary_row">—</td>
<td headers="grand_summary_stub_2 median_umis" class="gt_row gt_right gt_grand_summary_row">13,873</td>
<td headers="grand_summary_stub_2 median_features" class="gt_row gt_right gt_grand_summary_row">3,049</td>
</tr>
<tr>
<th id="grand_summary_stub_3" scope="row" class="gt_row gt_left gt_stub gt_grand_summary_row gt_last_summary_row">Sum</th>
<td headers="grand_summary_stub_3 louvain" class="gt_row gt_right gt_grand_summary_row gt_last_summary_row">—</td>
<td headers="grand_summary_stub_3 num_cells" class="gt_row gt_right gt_grand_summary_row gt_last_summary_row">11,182</td>
<td headers="grand_summary_stub_3 median_umis" class="gt_row gt_right gt_grand_summary_row gt_last_summary_row">—</td>
<td headers="grand_summary_stub_3 median_features" class="gt_row gt_right gt_grand_summary_row gt_last_summary_row">—</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">embedding</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        num_umis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html">colSums</a></span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">cell</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        num_features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html">colSums</a></span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">cell</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">batch</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>        num_cells <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        median_umis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">num_umis</span><span class="op">)</span>,</span>
<span>        median_features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">num_features</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        sample <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">batch</span> <span class="op">==</span> <span class="st">"PRJEB11202"</span> <span class="op">~</span> <span class="st">"Petropoulos et al., 2016"</span>,</span>
<span>            <span class="va">batch</span> <span class="op">==</span> <span class="st">"LW60"</span> <span class="op">~</span> <span class="st">"Blastoid, D9; HT; 5i/L/A"</span>,</span>
<span>            <span class="va">batch</span> <span class="op">==</span> <span class="st">"LW61"</span> <span class="op">~</span> <span class="st">"Blastoid, D9; HT; 5i/L/A"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>        <span class="va">sample</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/data_color.html">data_color</a></span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">median_umis</span><span class="op">)</span>,</span>
<span>        colors <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/col_numeric.html">col_numeric</a></span><span class="op">(</span></span>
<span>            palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                <span class="st">"green"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span></span>
<span>            <span class="op">)</span>,</span>
<span>            domain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7000</span>, <span class="fl">1600000</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/summary_rows.html">summary_rows</a></span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sample</span><span class="op">:</span><span class="va">batch</span><span class="op">)</span>,</span>
<span>        fns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>            Count <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        decimals <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/summary_rows.html">summary_rows</a></span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">median_umis</span><span class="op">:</span><span class="va">median_features</span><span class="op">)</span>,</span>
<span>        fns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>            Mean <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        decimals <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/summary_rows.html">summary_rows</a></span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">num_cells</span><span class="op">)</span>,</span>
<span>        fns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>            Sum <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        decimals <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/tab_header.html">tab_header</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/md.html">md</a></span><span class="op">(</span><span class="st">"**Blastoid Clustering**; Batch"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="awdrgnsbly" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

:where(#awdrgnsbly) .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

:where(#awdrgnsbly) .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#awdrgnsbly) .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

:where(#awdrgnsbly) .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

:where(#awdrgnsbly) .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#awdrgnsbly) .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#awdrgnsbly) .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

:where(#awdrgnsbly) .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

:where(#awdrgnsbly) .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

:where(#awdrgnsbly) .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

:where(#awdrgnsbly) .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

:where(#awdrgnsbly) .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

:where(#awdrgnsbly) .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

:where(#awdrgnsbly) .gt_from_md > :first-child {
  margin-top: 0;
}

:where(#awdrgnsbly) .gt_from_md > :last-child {
  margin-bottom: 0;
}

:where(#awdrgnsbly) .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

:where(#awdrgnsbly) .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#awdrgnsbly) .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

:where(#awdrgnsbly) .gt_row_group_first td {
  border-top-width: 2px;
}

:where(#awdrgnsbly) .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#awdrgnsbly) .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

:where(#awdrgnsbly) .gt_first_summary_row.thick {
  border-top-width: 2px;
}

:where(#awdrgnsbly) .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#awdrgnsbly) .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#awdrgnsbly) .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

:where(#awdrgnsbly) .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

:where(#awdrgnsbly) .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#awdrgnsbly) .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#awdrgnsbly) .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#awdrgnsbly) .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#awdrgnsbly) .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#awdrgnsbly) .gt_left {
  text-align: left;
}

:where(#awdrgnsbly) .gt_center {
  text-align: center;
}

:where(#awdrgnsbly) .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

:where(#awdrgnsbly) .gt_font_normal {
  font-weight: normal;
}

:where(#awdrgnsbly) .gt_font_bold {
  font-weight: bold;
}

:where(#awdrgnsbly) .gt_font_italic {
  font-style: italic;
}

:where(#awdrgnsbly) .gt_super {
  font-size: 65%;
}

:where(#awdrgnsbly) .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

:where(#awdrgnsbly) .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

:where(#awdrgnsbly) .gt_indent_1 {
  text-indent: 5px;
}

:where(#awdrgnsbly) .gt_indent_2 {
  text-indent: 10px;
}

:where(#awdrgnsbly) .gt_indent_3 {
  text-indent: 15px;
}

:where(#awdrgnsbly) .gt_indent_4 {
  text-indent: 20px;
}

:where(#awdrgnsbly) .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
<thead class="gt_header"><tr>
<td colspan="6" class="gt_heading gt_title gt_font_normal gt_bottom_border" style="">
<strong>Blastoid Clustering</strong>; Batch</td>
    </tr></thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=""></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="sample">sample</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="batch">batch</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="num_cells">num_cells</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="median_umis">median_umis</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="median_features">median_features</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<th id="stub_1_1" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_1 sample" class="gt_row gt_left">Blastoid, D9; HT; 5i/L/A</td>
<td headers="stub_1_1 batch" class="gt_row gt_left">LW60</td>
<td headers="stub_1_1 num_cells" class="gt_row gt_right">4497</td>
<td headers="stub_1_1 median_umis" class="gt_row gt_right" style="background-color: #18FE00; color: #000000;">14421</td>
<td headers="stub_1_1 median_features" class="gt_row gt_right">3337</td>
</tr>
<tr>
<th id="stub_1_2" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_2 sample" class="gt_row gt_left">Blastoid, D9; HT; 5i/L/A</td>
<td headers="stub_1_2 batch" class="gt_row gt_left">LW61</td>
<td headers="stub_1_2 num_cells" class="gt_row gt_right">5156</td>
<td headers="stub_1_2 median_umis" class="gt_row gt_right" style="background-color: #03FF00; color: #000000;">7625</td>
<td headers="stub_1_2 median_features" class="gt_row gt_right">2185</td>
</tr>
<tr>
<th id="stub_1_3" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_3 sample" class="gt_row gt_left">Petropoulos et al., 2016</td>
<td headers="stub_1_3 batch" class="gt_row gt_left">PRJEB11202</td>
<td headers="stub_1_3 num_cells" class="gt_row gt_right">1529</td>
<td headers="stub_1_3 median_umis" class="gt_row gt_right" style="background-color: #FF2200; color: #FFFFFF;">1551093</td>
<td headers="stub_1_3 median_features" class="gt_row gt_right">10305</td>
</tr>
<tr>
<th id="grand_summary_stub_1" scope="row" class="gt_row gt_left gt_stub gt_grand_summary_row gt_first_grand_summary_row">Count</th>
<td headers="grand_summary_stub_1 sample" class="gt_row gt_left gt_grand_summary_row gt_first_grand_summary_row">3</td>
<td headers="grand_summary_stub_1 batch" class="gt_row gt_left gt_grand_summary_row gt_first_grand_summary_row">3</td>
<td headers="grand_summary_stub_1 num_cells" class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row">—</td>
<td headers="grand_summary_stub_1 median_umis" class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row">—</td>
<td headers="grand_summary_stub_1 median_features" class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row">—</td>
</tr>
<tr>
<th id="grand_summary_stub_2" scope="row" class="gt_row gt_left gt_stub gt_grand_summary_row">Mean</th>
<td headers="grand_summary_stub_2 sample" class="gt_row gt_left gt_grand_summary_row">—</td>
<td headers="grand_summary_stub_2 batch" class="gt_row gt_left gt_grand_summary_row">—</td>
<td headers="grand_summary_stub_2 num_cells" class="gt_row gt_right gt_grand_summary_row">—</td>
<td headers="grand_summary_stub_2 median_umis" class="gt_row gt_right gt_grand_summary_row">524,380</td>
<td headers="grand_summary_stub_2 median_features" class="gt_row gt_right gt_grand_summary_row">5,276</td>
</tr>
<tr>
<th id="grand_summary_stub_3" scope="row" class="gt_row gt_left gt_stub gt_grand_summary_row gt_last_summary_row">Sum</th>
<td headers="grand_summary_stub_3 sample" class="gt_row gt_left gt_grand_summary_row gt_last_summary_row">—</td>
<td headers="grand_summary_stub_3 batch" class="gt_row gt_left gt_grand_summary_row gt_last_summary_row">—</td>
<td headers="grand_summary_stub_3 num_cells" class="gt_row gt_right gt_grand_summary_row gt_last_summary_row">11,182</td>
<td headers="grand_summary_stub_3 median_umis" class="gt_row gt_right gt_grand_summary_row gt_last_summary_row">—</td>
<td headers="grand_summary_stub_3 median_features" class="gt_row gt_right gt_grand_summary_row gt_last_summary_row">—</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    <span class="va">p_embedding_louvain</span>,</span>
<span>    <span class="va">p_embedding_batch</span>,</span>
<span>    <span class="va">p_embedding_UMI</span>,</span>
<span>    <span class="va">p_embedding_POU5F1</span></span>
<span><span class="op">)</span>, <span class="va">`+`</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span></span>
<span>        theme <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="analyze_blastoids_files/figure-html/unnamed-chunk-21-1.png" style="width:80.0%;height:80.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section><section id="developmental-stages" class="level4 page-columns page-full"><h4 class="anchored" data-anchor-id="developmental-stages">Developmental stages</h4>
<p><br></p>
<p><strong>Salmon</strong>: highlighted group of cells; <strong>Light grey</strong>: cells belonging to this dataset but not the highlighted group; <strong>Dark grey</strong>: cells belonging to other datasets.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">embedding</span><span class="op">$</span><span class="va">developmental_stage</span><span class="op">)</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">embedding</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>        color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">embedding</span><span class="op">$</span><span class="va">developmental_stage</span> <span class="op">==</span> <span class="va">x</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        label <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span></span>
<span>            <span class="st">"{EMBEDDING_TITLE_PREFIX}; Petropoulos et al., 2016, {x}"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        color_legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        sort_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        geom_point_size <span class="op">=</span> <span class="va">GEOM_POINT_SIZE</span>,</span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">theme_customized_embedding</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey70"</span>, <span class="st">"salmon"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">`+`</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span></span>
<span>        theme <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display column-body-outset">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="analyze_blastoids_files/figure-html/unnamed-chunk-22-1.png" style="width:100.0%;height:100.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section><section id="polishing" class="level4"><h4 class="anchored" data-anchor-id="polishing">Polishing</h4>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">color_palette_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"0"</span> <span class="op">=</span> <span class="st">"#8DD3C7"</span>,</span>
<span>    <span class="st">"1"</span> <span class="op">=</span> <span class="st">"#9EDAE5FF"</span>,</span>
<span>    <span class="st">"2"</span> <span class="op">=</span> <span class="st">"#BEBADA"</span>,</span>
<span>    <span class="st">"3"</span> <span class="op">=</span> <span class="st">"#FB8072"</span>,</span>
<span>    <span class="st">"4"</span> <span class="op">=</span> <span class="st">"#80B1D3"</span>,</span>
<span>    <span class="st">"5"</span> <span class="op">=</span> <span class="st">"#FDB462"</span>,</span>
<span>    <span class="st">"6"</span> <span class="op">=</span> <span class="st">"#B3DE69"</span>,</span>
<span>    <span class="st">"7"</span> <span class="op">=</span> <span class="st">"#FCCDE5"</span>,</span>
<span>    <span class="st">"8"</span> <span class="op">=</span> <span class="st">"#DC863B"</span>,</span>
<span>    <span class="st">"9"</span> <span class="op">=</span> <span class="st">"#BC80BD"</span>,</span>
<span>    <span class="st">"10"</span> <span class="op">=</span> <span class="st">"#11c638"</span>,</span>
<span>    <span class="st">"11"</span> <span class="op">=</span> <span class="st">"#BCBD22FF"</span>,</span>
<span>    <span class="st">"12"</span> <span class="op">=</span> <span class="st">"#17BECFFF"</span>,</span>
<span>    <span class="st">"13"</span> <span class="op">=</span> <span class="st">"#AEC7E8FF"</span>,</span>
<span>    <span class="st">"14"</span> <span class="op">=</span> <span class="st">"#EAD3C6"</span>,</span>
<span>    <span class="st">"15"</span> <span class="op">=</span> <span class="st">"#98DF8AFF"</span>,</span>
<span>    <span class="st">"16"</span> <span class="op">=</span> <span class="st">"#FF9896FF"</span>,</span>
<span>    <span class="st">"17"</span> <span class="op">=</span> <span class="st">"#C5B0D5FF"</span>,</span>
<span>    <span class="st">"18"</span> <span class="op">=</span> <span class="st">"#C49C94FF"</span>,</span>
<span>    <span class="st">"19"</span> <span class="op">=</span> <span class="st">"#F7B6D2FF"</span>,</span>
<span>    <span class="st">"20"</span> <span class="op">=</span> <span class="st">"#D33F6A"</span>,</span>
<span>    <span class="st">"21"</span> <span class="op">=</span> <span class="st">"#8E063B"</span>,</span>
<span>    <span class="st">"22"</span> <span class="op">=</span> <span class="st">"#023FA5"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cluster_labels</span> <span class="op">&lt;-</span> <span class="va">embedding</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="st">"louvain"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">x_column</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">y_column</span><span class="op">]</span><span class="op">]</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cluster_labels</span><span class="op">[</span><span class="va">cluster_labels</span><span class="op">[[</span><span class="st">"louvain"</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="fl">14</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6.8</span>, <span class="op">-</span><span class="fl">1.8</span><span class="op">)</span></span>
<span></span>
<span><span class="va">clusters_unidentified</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">13</span>, <span class="fl">15</span>, <span class="fl">16</span><span class="op">)</span></span>
<span><span class="va">cluster_labels</span> <span class="op">&lt;-</span> <span class="va">cluster_labels</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        label <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">louvain</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">clusters_unidentified</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span></span>
<span>                <span class="st">"U"</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">louvain</span><span class="op">)</span></span>
<span>            <span class="op">)</span>,</span>
<span>            <span class="cn">TRUE</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">louvain</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># cluster</span></span>
<span><span class="va">p_embedding_cluster</span> <span class="op">&lt;-</span> <span class="va">embedding</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">louvain</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>            x <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">x_column</span><span class="op">]</span><span class="op">]</span>,</span>
<span>            y <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">y_column</span><span class="op">]</span><span class="op">]</span>,</span>
<span>            color <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="st">"louvain"</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span></span>
<span>        size <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span>        alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        stroke <span class="op">=</span> <span class="fl">0</span>,</span>
<span>        shape <span class="op">=</span> <span class="fl">16</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span></span>
<span>        values <span class="op">=</span> <span class="va">color_palette_cluster</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span></span>
<span>        <span class="st">"text"</span>,</span>
<span>        family <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>        x <span class="op">=</span> <span class="va">cluster_labels</span><span class="op">[</span>, <span class="st">"x"</span><span class="op">]</span>,</span>
<span>        y <span class="op">=</span> <span class="va">cluster_labels</span><span class="op">[</span>, <span class="st">"y"</span><span class="op">]</span>,</span>
<span>        label <span class="op">=</span> <span class="va">cluster_labels</span><span class="op">[</span>, <span class="st">"label"</span><span class="op">]</span>,</span>
<span>        parse <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># lineage</span></span>
<span><span class="va">p_embedding_lineage</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="va">embedding</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>            value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">lineage</span>,</span>
<span>                levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Blastoid"</span>, <span class="st">"TE"</span>, <span class="st">"HYP"</span>, <span class="st">"EPI"</span>, <span class="st">"Pre-lineage"</span><span class="op">)</span></span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span>void <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey70"</span>, <span class="st">"#8ace7e"</span>, <span class="st">"#ff684c"</span>, <span class="st">"#9467bd"</span>, <span class="st">"#ffd8b1"</span><span class="op">)</span>,</span>
<span>        breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Blastoid"</span>, <span class="st">"EPI"</span>, <span class="st">"HYP"</span>, <span class="st">"TE"</span>, <span class="st">"Pre-lineage"</span><span class="op">)</span>,</span>
<span>        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>            <span class="st">"Blastoid cells"</span>, <span class="st">"Epiblast (EPI)"</span>, <span class="st">"Hypoblast (HYP)"</span>,</span>
<span>            <span class="st">"Trophectoderm (TE)"</span>, <span class="st">"Pre-lineage"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        na.value <span class="op">=</span> <span class="st">"grey70"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># developmental stage</span></span>
<span><span class="va">p_embedding_developmental_stage</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="va">embedding</span><span class="op">$</span><span class="va">developmental_stage</span>,</span>
<span>    label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span>void <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>            <span class="st">"grey70"</span>,</span>
<span>            <span class="fu">ggthemes</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/tableau_color_pal.html">tableau_color_pal</a></span><span class="op">(</span><span class="st">"Tableau 10"</span><span class="op">)</span><span class="op">(</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">embedding</span><span class="op">$</span><span class="va">developmental_stage</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Blastoid cells"</span>, <span class="st">"E3"</span>, <span class="st">"E4"</span>, <span class="st">"E5"</span>, <span class="st">"E6"</span>, <span class="st">"E7"</span><span class="op">)</span>,</span>
<span>        na.value <span class="op">=</span> <span class="st">"grey70"</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">features_selected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"ENSG00000181449_SOX2"</span>,</span>
<span>    <span class="st">"ENSG00000187498_COL4A1"</span>,</span>
<span>    <span class="st">"ENSG00000179348_GATA2"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">lineage_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"(Epiblast)"</span>,</span>
<span>    <span class="st">"(Hypoblast)"</span>,</span>
<span>    <span class="st">"(Trophectoderm)"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">CB_POSITION</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.875</span>, <span class="fl">0.32</span><span class="op">)</span></span>
<span><span class="va">x_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot_build.html">ggplot_build</a></span><span class="op">(</span></span>
<span>    <span class="va">p_embedding_POU5F1</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">layout</span><span class="op">$</span><span class="va">panel_params</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x.range"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="fl">0.575</span><span class="op">)</span></span>
<span><span class="va">y_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot_build.html">ggplot_build</a></span><span class="op">(</span></span>
<span>    <span class="va">p_embedding_POU5F1</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">layout</span><span class="op">$</span><span class="va">panel_params</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"y.range"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_embedding_SOX2_COL4A1_GATA2</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span></span>
<span>    <span class="va">features_selected</span>, <span class="va">lineage_labels</span>, \<span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">selected_feature</span> <span class="op">&lt;-</span> <span class="va">x</span></span>
<span>        <span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="fu">calc_cpm</span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">)</span><span class="op">[</span><span class="va">x</span>, <span class="va">embedding</span><span class="op">$</span><span class="va">cell</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>        <span class="va">values</span><span class="op">[</span><span class="va">embedding</span><span class="op">$</span><span class="va">batch</span> <span class="op">==</span> <span class="st">"PRJEB11202"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span>        <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>            data <span class="op">=</span> <span class="va">embedding</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>            color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span></span>
<span>                <span class="fu">calc_cpm</span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">embedding</span><span class="op">$</span><span class="va">cell</span><span class="op">]</span><span class="op">)</span></span>
<span>                <span class="op">[</span><span class="va">selected_feature</span>, <span class="op">]</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>            <span class="op">)</span>,</span>
<span>            label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>            color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            sort_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>            geom_point_size <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>            na_value <span class="op">=</span> <span class="st">"grey70"</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu">theme_customized_embedding</span><span class="op">(</span></span>
<span>                x <span class="op">=</span> <span class="va">CB_POSITION</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                y <span class="op">=</span> <span class="va">CB_POSITION</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                void <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                legend_key_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span></span>
<span>            <span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span></span>
<span>                geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>                x <span class="op">=</span> <span class="va">x_label</span>,</span>
<span>                y <span class="op">=</span> <span class="va">y_label</span>,</span>
<span>                label <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span></span>
<span>                    <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"^E.+_"</span><span class="op">)</span>,</span>
<span>                    <span class="va">y</span>,</span>
<span>                    sep <span class="op">=</span> <span class="st">"\n"</span></span>
<span>                <span class="op">)</span>,</span>
<span>                family <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>                color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>                size <span class="op">=</span> <span class="fl">5</span> <span class="op">/</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/graphical-units.html">.pt</a></span>,</span>
<span>                hjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                vjust <span class="op">=</span> <span class="fl">0</span></span>
<span>                <span class="co"># parse = TRUE</span></span>
<span>            <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>        <span class="va">p_embedding_cluster</span>,</span>
<span>        <span class="va">p_embedding_lineage</span>,</span>
<span>        <span class="va">p_embedding_developmental_stage</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="va">p_embedding_SOX2_COL4A1_GATA2</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">`+`</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span></span>
<span>        theme <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="analyze_blastoids_files/figure-html/unnamed-chunk-25-1.png" style="width:90.0%;height:90.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="expression" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="expression">Expression</h3>
<section id="embedding-1" class="level4"><h4 class="anchored" data-anchor-id="embedding-1">Embedding</h4>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">features_selected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"ENSG00000204531_POU5F1"</span>,</span>
<span>    <span class="st">"ENSG00000203909_DPPA5"</span>,</span>
<span>    <span class="st">"ENSG00000184344_GDF3"</span>,</span>
<span>    <span class="st">"ENSG00000156574_NODAL"</span>,</span>
<span>    <span class="st">"ENSG00000111704_NANOG"</span>,</span>
<span>    <span class="st">"ENSG00000075388_FGF4"</span>,</span>
<span>    <span class="co">#</span></span>
<span>    <span class="st">"ENSG00000164736_SOX17"</span>,</span>
<span>    <span class="st">"ENSG00000125798_FOXA2"</span>,</span>
<span>    <span class="st">"ENSG00000136574_GATA4"</span>,</span>
<span>    <span class="st">"ENSG00000141448_GATA6"</span>,</span>
<span>    <span class="st">"ENSG00000134853_PDGFRA"</span>,</span>
<span>    <span class="st">"ENSG00000115414_FN1"</span>,</span>
<span>    <span class="co">#</span></span>
<span>    <span class="st">"ENSG00000107485_GATA3"</span>,</span>
<span>    <span class="st">"ENSG00000118777_ABCG2"</span>,</span>
<span>    <span class="st">"ENSG00000165556_CDX2"</span>,</span>
<span>    <span class="st">"ENSG00000137869_CYP19A1"</span>,</span>
<span>    <span class="st">"ENSG00000172818_OVOL1"</span>,</span>
<span>    <span class="st">"ENSG00000126353_CCR7"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">features_selected</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">selected_feature</span> <span class="op">&lt;-</span> <span class="va">x</span></span>
<span>    <span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="fu">calc_cpm</span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">)</span><span class="op">[</span><span class="va">x</span>, <span class="va">embedding</span><span class="op">$</span><span class="va">cell</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">values</span><span class="op">[</span><span class="va">embedding</span><span class="op">$</span><span class="va">batch</span> <span class="op">==</span> <span class="st">"PRJEB11202"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span>    <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">embedding</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>        color <span class="op">=</span> <span class="va">values</span>,</span>
<span>        label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        sort_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>        geom_point_size <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>        na_value <span class="op">=</span> <span class="st">"grey70"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">theme_customized_embedding</span><span class="op">(</span></span>
<span>            x <span class="op">=</span> <span class="va">CB_POSITION</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>            y <span class="op">=</span> <span class="va">CB_POSITION</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>            void <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            legend_key_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span></span>
<span>            geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>            x <span class="op">=</span> <span class="va">x_label</span>,</span>
<span>            y <span class="op">=</span> <span class="va">y_label</span>,</span>
<span>            label <span class="op">=</span> <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"^E.+_"</span><span class="op">)</span>,</span>
<span>            family <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>            color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">5</span> <span class="op">/</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/graphical-units.html">.pt</a></span>,</span>
<span>            hjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>            vjust <span class="op">=</span> <span class="fl">0</span></span>
<span>            <span class="co"># parse = TRUE</span></span>
<span>        <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">`+`</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span></span>
<span>        theme <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="analyze_blastoids_files/figure-html/unnamed-chunk-26-1.png" style="width:100.0%;height:100.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section><section id="lollipop" class="level4"><h4 class="anchored" data-anchor-id="lollipop">Lollipop</h4>
<div class="cell">

</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">clusters_selected_lollipop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">11</span>,</span>
<span>    <span class="fl">18</span>,</span>
<span>    <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">12</span>, <span class="fl">17</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cells_selected_lollipop</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">clusters_selected_lollipop</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">embedding</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>            <span class="va">louvain</span> <span class="op">==</span> <span class="va">x</span>,</span>
<span>            <span class="va">batch</span> <span class="op">!=</span> <span class="st">"PRJEB11202"</span></span>
<span>        <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">cell</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cells_selected_lollipop</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">clusters_selected_lollipop</span></span>
<span></span>
<span><span class="va">features_selected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"ENSG00000181449_SOX2"</span>,</span>
<span>    <span class="st">"ENSG00000156574_NODAL"</span>,</span>
<span>    <span class="st">"ENSG00000111704_NANOG"</span>,</span>
<span>    <span class="st">"ENSG00000147596_PRDM14"</span>,</span>
<span>    <span class="st">"ENSG00000075388_FGF4"</span>,</span>
<span>    <span class="co">#</span></span>
<span>    <span class="st">"ENSG00000164736_SOX17"</span>,</span>
<span>    <span class="st">"ENSG00000125798_FOXA2"</span>,</span>
<span>    <span class="st">"ENSG00000136574_GATA4"</span>,</span>
<span>    <span class="st">"ENSG00000141448_GATA6"</span>,</span>
<span>    <span class="st">"ENSG00000115414_FN1"</span>,</span>
<span>    <span class="st">"ENSG00000187498_COL4A1"</span>,</span>
<span>    <span class="co">#</span></span>
<span>    <span class="st">"ENSG00000179348_GATA2"</span>,</span>
<span>    <span class="st">"ENSG00000107485_GATA3"</span>,</span>
<span>    <span class="st">"ENSG00000118777_ABCG2"</span>,</span>
<span>    <span class="co">#</span></span>
<span>    <span class="st">"ENSG00000126353_CCR7"</span>,</span>
<span>    <span class="st">"ENSG00000137869_CYP19A1"</span>,</span>
<span>    <span class="st">"ENSG00000169550_MUC15"</span>,</span>
<span>    <span class="st">"ENSG00000172818_OVOL1"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_lollipop</span><span class="op">(</span></span>
<span>    cells <span class="op">=</span> <span class="va">cells_selected_lollipop</span>,</span>
<span>    features <span class="op">=</span> <span class="va">features_selected</span>,</span>
<span>    matrix_cpm <span class="op">=</span> <span class="fu">calc_cpm</span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">)</span>,</span>
<span>    size_range_limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>    dot_size <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>        legend.box <span class="op">=</span> <span class="st">"horizontal"</span>,</span>
<span>        axis.text.x.top <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span></span>
<span>            angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust <span class="op">=</span> <span class="fl">0</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="analyze_blastoids_files/figure-html/unnamed-chunk-28-1.png" style="width:60.0%;height:60.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section><section id="violin" class="level4 page-columns page-full"><h4 class="anchored" data-anchor-id="violin">Violin</h4>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">features_selected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"ENSG00000204531_POU5F1"</span>,</span>
<span>    <span class="st">"ENSG00000203909_DPPA5"</span>,</span>
<span>    <span class="st">"ENSG00000125798_FOXA2"</span>,</span>
<span>    <span class="st">"ENSG00000134853_PDGFRA"</span>,</span>
<span>    <span class="st">"ENSG00000107485_GATA3"</span>,</span>
<span>    <span class="st">"ENSG00000118777_ABCG2"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">clusters_selected_violin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">11</span>,</span>
<span>    <span class="fl">18</span>,</span>
<span>    <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">12</span>, <span class="fl">17</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># blastoid</span></span>
<span><span class="va">cells_violin</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">clusters_selected_violin</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">embedding</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>            <span class="va">louvain</span> <span class="op">==</span> <span class="va">x</span>,</span>
<span>            <span class="va">batch</span> <span class="op">!=</span> <span class="st">"PRJEB11202"</span></span>
<span>        <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">cell</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cells_violin</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">clusters_selected_violin</span></span>
<span></span>
<span><span class="va">p_violin_blastoid</span> <span class="op">&lt;-</span> <span class="fu">plot_violin</span><span class="op">(</span></span>
<span>    cells <span class="op">=</span> <span class="va">cells_violin</span>,</span>
<span>    features <span class="op">=</span> <span class="va">features_selected</span>,</span>
<span>    matrix_cpm <span class="op">=</span> <span class="fu">calc_cpm</span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">)</span>,</span>
<span>    x_range_breaks <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        values <span class="op">=</span> <span class="va">color_palette_cluster</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        values <span class="op">=</span> <span class="va">color_palette_cluster</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Blastoids; 10x Genomics"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_violin</span><span class="op">(</span>panel_border_color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>        plot.title <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span></span>
<span>            family <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">8</span>,</span>
<span>            margin <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span></span>
<span>                t <span class="op">=</span> <span class="fl">0</span>, r <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">1</span>, l <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                unit <span class="op">=</span> <span class="st">"mm"</span></span>
<span>            <span class="op">)</span>,</span>
<span>            hjust <span class="op">=</span> <span class="fl">0.5</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0. Please use
`linewidth` instead.
ℹ The deprecated feature was likely used in the ggplot2 package.
  Please report the issue at &lt;https://github.com/tidyverse/ggplot2/issues&gt;.</code></pre>
</div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># in vivo</span></span>
<span><span class="va">cells_violin</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">clusters_selected_violin</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">embedding</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>            <span class="va">louvain</span> <span class="op">==</span> <span class="va">x</span>,</span>
<span>            <span class="va">batch</span> <span class="op">==</span> <span class="st">"PRJEB11202"</span></span>
<span>        <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">cell</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cells_violin</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">clusters_selected_violin</span></span>
<span></span>
<span><span class="co"># re-aligned</span></span>
<span><span class="va">p_violin_PRJEB11202</span> <span class="op">&lt;-</span> <span class="fu">plot_violin</span><span class="op">(</span></span>
<span>    cells <span class="op">=</span> <span class="va">cells_violin</span>,</span>
<span>    features <span class="op">=</span> <span class="va">features_selected</span>,</span>
<span>    matrix_cpm <span class="op">=</span> <span class="fu">calc_cpm</span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">)</span>,</span>
<span>    x_range_breaks <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    y_title <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        values <span class="op">=</span> <span class="va">color_palette_cluster</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        values <span class="op">=</span> <span class="va">color_palette_cluster</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Human pre-implantation embryos; Smart-Seq2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_violin</span><span class="op">(</span>panel_border_color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>        plot.title <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span></span>
<span>            family <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">8</span>,</span>
<span>            margin <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span></span>
<span>                t <span class="op">=</span> <span class="fl">0</span>, r <span class="op">=</span> <span class="fl">0</span>, b <span class="op">=</span> <span class="fl">1</span>, l <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                unit <span class="op">=</span> <span class="st">"mm"</span></span>
<span>            <span class="op">)</span>,</span>
<span>            hjust <span class="op">=</span> <span class="fl">0.5</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">p_violin_PRJEB11202</span> <span class="op">&lt;-</span> <span class="va">p_violin_PRJEB11202</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>        axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">p_violin_blastoid_dims</span> <span class="op">&lt;-</span> <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/multipage_align.html">get_dim</a></span><span class="op">(</span><span class="va">p_violin_blastoid</span><span class="op">)</span></span>
<span><span class="va">p_violin_PRJEB11202_aligned</span> <span class="op">&lt;-</span> <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/multipage_align.html">set_dim</a></span><span class="op">(</span></span>
<span>    <span class="va">p_violin_PRJEB11202</span>,</span>
<span>    <span class="va">p_violin_blastoid_dims</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span></span>
<span>    <span class="va">p_violin_blastoid</span>, <span class="va">p_violin_PRJEB11202_aligned</span>,</span>
<span>    ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    clip <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display column-body-outset">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="analyze_blastoids_files/figure-html/unnamed-chunk-30-1.png" style="width:100.0%;height:100.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="cluster-composition" class="level3"><h3 class="anchored" data-anchor-id="cluster-composition">Cluster composition</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">clusters_selected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">11</span>,</span>
<span>    <span class="fl">18</span>,</span>
<span>    <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">12</span>, <span class="fl">17</span>,</span>
<span>    <span class="fl">10</span>, <span class="fl">14</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cell_distribution_labels_right</span> <span class="op">&lt;-</span> <span class="fu">calc_group_composition</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"louvain"</span>,</span>
<span>    group <span class="op">=</span> <span class="st">"lineage"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">lineage</span><span class="op">)</span>,</span>
<span>        <span class="va">louvain</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">clusters_selected</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        louvain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>            <span class="va">louvain</span>,</span>
<span>            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">louvain</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">cell_distribution_labels_left</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>    <span class="op">~</span><span class="va">louvain</span>, <span class="op">~</span><span class="va">lineage</span>, <span class="op">~</span><span class="va">label_position</span>, <span class="op">~</span><span class="va">percentage</span>,</span>
<span>    <span class="fl">11L</span>, <span class="st">"EPI"</span>, <span class="fl">0.068306011</span>, <span class="fl">0.136612022</span>,</span>
<span>    <span class="fl">18L</span>, <span class="st">"HYP"</span>, <span class="fl">0.20930232</span>, <span class="fl">0.37209302</span>,</span>
<span>    <span class="fl">0L</span>, <span class="st">"TE"</span>, <span class="fl">0.036855838</span>, <span class="fl">0.063274625</span>,</span>
<span>    <span class="fl">1L</span>, <span class="st">"TE"</span>, <span class="fl">0.20350404</span>, <span class="fl">0.33513028</span>,</span>
<span>    <span class="fl">8L</span>, <span class="st">"TE"</span>, <span class="fl">0.095531587</span>, <span class="fl">0.181818182</span>,</span>
<span>    <span class="fl">9L</span>, <span class="st">"TE"</span>, <span class="fl">0.19649123</span>, <span class="fl">0.2877193</span>,</span>
<span>    <span class="fl">12L</span>, <span class="st">"TE"</span>, <span class="fl">0.073972603</span>, <span class="fl">0.126027397</span>,</span>
<span>    <span class="fl">17L</span>, <span class="st">"TE"</span>, <span class="fl">0.09583335</span>, <span class="fl">0.1916667</span>,</span>
<span>    <span class="fl">10L</span>, <span class="st">"Pre-lineage"</span>, <span class="fl">0.284146342</span>, <span class="fl">0.412195122</span>,</span>
<span>    <span class="fl">14L</span>, <span class="st">"Pre-lineage"</span>, <span class="fl">0.24698795</span>, <span class="fl">0.4939759</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        louvain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>            <span class="va">louvain</span>,</span>
<span>            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">clusters_selected</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="fu">calc_group_composition</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"louvain"</span>,</span>
<span>    group <span class="op">=</span> <span class="st">"lineage"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">louvain</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">clusters_selected</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        louvain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">louvain</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="va">clusters_selected</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        lineage <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">lineage</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Blastoid"</span>,</span>
<span>            <span class="cn">TRUE</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">lineage</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        lineage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">lineage</span>,</span>
<span>            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"EPI"</span>, <span class="st">"HYP"</span>, <span class="st">"TE"</span>, <span class="st">"Pre-lineage"</span>, <span class="st">"Blastoid"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">plot_barplot</span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="st">"louvain"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"percentage"</span>,</span>
<span>        z <span class="op">=</span> <span class="st">"lineage"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>        panel.grid.major.y <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey85"</span>, <span class="st">"#8ace7e"</span>, <span class="st">"#ff684c"</span>, <span class="st">"#9467bd"</span>, <span class="st">"#ffd8b1"</span><span class="op">)</span>,</span>
<span>        breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Blastoid"</span>, <span class="st">"EPI"</span>, <span class="st">"HYP"</span>, <span class="st">"TE"</span>, <span class="st">"Pre-lineage"</span><span class="op">)</span>,</span>
<span>        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>            <span class="st">"Blastoid cells"</span>, <span class="st">"Epiblast (EPI)"</span>, <span class="st">"Hypoblast (HYP)"</span>,</span>
<span>            <span class="st">"Trophectoderm (TE)"</span>, <span class="st">"Pre-lineage"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span></span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>            y <span class="op">=</span> <span class="va">label_position</span>,</span>
<span>            x <span class="op">=</span> <span class="va">louvain</span>,</span>
<span>            label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">(</span><span class="va">percentage</span>, accuracy <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span>,</span>
<span>            group <span class="op">=</span> <span class="cn">NULL</span></span>
<span>        <span class="op">)</span>,</span>
<span>        size <span class="op">=</span> <span class="fl">1.8</span>,</span>
<span>        family <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        data <span class="op">=</span> <span class="va">cell_distribution_labels_left</span>,</span>
<span>        hjust <span class="op">=</span> <span class="fl">0.5</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span></span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>            y <span class="op">=</span> <span class="fl">0.825</span>,</span>
<span>            x <span class="op">=</span> <span class="va">louvain</span>,</span>
<span>            label <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">(</span><span class="va">percentage</span>, accuracy <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span>,</span>
<span>            group <span class="op">=</span> <span class="cn">NULL</span></span>
<span>        <span class="op">)</span>,</span>
<span>        size <span class="op">=</span> <span class="fl">1.8</span>,</span>
<span>        family <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        data <span class="op">=</span> <span class="va">cell_distribution_labels_right</span>,</span>
<span>        hjust <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="analyze_blastoids_files/figure-html/unnamed-chunk-31-1.png" style="width:60.0%;height:60.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section><section id="heatmap-construction" class="level3"><h3 class="anchored" data-anchor-id="heatmap-construction">Heatmap construction</h3>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># prepare features; cells; heatmap matrix;</span></span>
<span><span class="va">features_heatmap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"ENSG00000204531_POU5F1"</span>,</span>
<span>    <span class="st">"ENSG00000184344_GDF3"</span>,</span>
<span>    <span class="st">"ENSG00000203909_DPPA5"</span>,</span>
<span>    <span class="st">"ENSG00000181449_SOX2"</span>,</span>
<span>    <span class="st">"ENSG00000111704_NANOG"</span>,</span>
<span>    <span class="st">"ENSG00000241186_TDGF1"</span>,</span>
<span>    <span class="st">"ENSG00000156574_NODAL"</span>,</span>
<span>    <span class="st">"ENSG00000254339_AC064802.1"</span>,</span>
<span>    <span class="st">"ENSG00000283567_C19orf85"</span>,</span>
<span>    <span class="st">"ENSG00000151650_VENTX"</span>,</span>
<span>    <span class="st">"ENSG00000163032_VSNL1"</span>,</span>
<span>    <span class="st">"ENSG00000159231_CBR3"</span>,</span>
<span>    <span class="st">"ENSG00000145423_SFRP2"</span>,</span>
<span>    <span class="st">"ENSG00000006468_ETV1"</span>,</span>
<span>    <span class="st">"ENSG00000147596_PRDM14"</span>,</span>
<span>    <span class="co">#</span></span>
<span>    <span class="st">"ENSG00000136574_GATA4"</span>,</span>
<span>    <span class="st">"ENSG00000164266_SPINK1"</span>,</span>
<span>    <span class="st">"ENSG00000158966_CACHD1"</span>,</span>
<span>    <span class="st">"ENSG00000164093_PITX2"</span>,</span>
<span>    <span class="st">"ENSG00000087303_NID2"</span>,</span>
<span>    <span class="st">"ENSG00000174358_SLC6A19"</span>,</span>
<span>    <span class="st">"ENSG00000134962_KLB"</span>,</span>
<span>    <span class="st">"ENSG00000167780_SOAT2"</span>,</span>
<span>    <span class="st">"ENSG00000110245_APOC3"</span>,</span>
<span>    <span class="st">"ENSG00000170558_CDH2"</span>,</span>
<span>    <span class="st">"ENSG00000125848_FLRT3"</span>,</span>
<span>    <span class="st">"ENSG00000129538_RNASE1"</span>,</span>
<span>    <span class="st">"ENSG00000100079_LGALS2"</span>,</span>
<span>    <span class="st">"ENSG00000134853_PDGFRA"</span>,</span>
<span>    <span class="st">"ENSG00000164736_SOX17"</span>,</span>
<span>    <span class="st">"ENSG00000017427_IGF1"</span>,</span>
<span>    <span class="st">"ENSG00000275410_HNF1B"</span>,</span>
<span>    <span class="st">"ENSG00000118137_APOA1"</span>,</span>
<span>    <span class="st">"ENSG00000198336_MYL4"</span>,</span>
<span>    <span class="st">"ENSG00000171557_FGG"</span>,</span>
<span>    <span class="st">"ENSG00000125798_FOXA2"</span>,</span>
<span>    <span class="st">"ENSG00000146374_RSPO3"</span>,</span>
<span>    <span class="st">"ENSG00000115414_FN1"</span>,</span>
<span>    <span class="st">"ENSG00000164292_RHOBTB3"</span>,</span>
<span>    <span class="st">"ENSG00000141448_GATA6"</span>,</span>
<span>    <span class="st">"ENSG00000187498_COL4A1"</span>,</span>
<span>    <span class="co">#</span></span>
<span>    <span class="st">"ENSG00000196549_MME"</span>,</span>
<span>    <span class="st">"ENSG00000138814_PPP3CA"</span>,</span>
<span>    <span class="st">"ENSG00000082074_FYB1"</span>,</span>
<span>    <span class="st">"ENSG00000123191_ATP7B"</span>,</span>
<span>    <span class="st">"ENSG00000175318_GRAMD2A"</span>,</span>
<span>    <span class="st">"ENSG00000100593_ISM2"</span>,</span>
<span>    <span class="st">"ENSG00000265107_GJA5"</span>,</span>
<span>    <span class="st">"ENSG00000226887_ERVMER34-1"</span>,</span>
<span>    <span class="st">"ENSG00000183734_ASCL2"</span>,</span>
<span>    <span class="st">"ENSG00000143850_PLEKHA6"</span>,</span>
<span>    <span class="st">"ENSG00000103534_TMC5"</span>,</span>
<span>    <span class="st">"ENSG00000132470_ITGB4"</span>,</span>
<span>    <span class="st">"ENSG00000180999_C1orf105"</span>,</span>
<span>    <span class="st">"ENSG00000109610_SOD3"</span>,</span>
<span>    <span class="st">"ENSG00000143369_ECM1"</span>,</span>
<span>    <span class="st">"ENSG00000204632_HLA-G"</span>,</span>
<span>    <span class="st">"ENSG00000113594_LIFR"</span>,</span>
<span>    <span class="st">"ENSG00000168394_TAP1"</span>,</span>
<span>    <span class="st">"ENSG00000183287_CCBE1"</span>,</span>
<span>    <span class="st">"ENSG00000079393_DUSP13"</span>,</span>
<span>    <span class="st">"ENSG00000121769_FABP3"</span>,</span>
<span>    <span class="st">"ENSG00000182985_CADM1"</span>,</span>
<span>    <span class="st">"ENSG00000164692_COL1A2"</span>,</span>
<span>    <span class="st">"ENSG00000112655_PTK7"</span>,</span>
<span>    <span class="st">"ENSG00000134873_CLDN10"</span>,</span>
<span>    <span class="st">"ENSG00000108375_RNF43"</span>,</span>
<span>    <span class="st">"ENSG00000254726_MEX3A"</span>,</span>
<span>    <span class="st">"ENSG00000164120_HPGD"</span>,</span>
<span>    <span class="st">"ENSG00000081026_MAGI3"</span>,</span>
<span>    <span class="st">"ENSG00000120738_EGR1"</span>,</span>
<span>    <span class="st">"ENSG00000108960_MMD"</span>,</span>
<span>    <span class="st">"ENSG00000112137_PHACTR1"</span>,</span>
<span>    <span class="st">"ENSG00000166450_PRTG"</span>,</span>
<span>    <span class="st">"ENSG00000164099_PRSS12"</span>,</span>
<span>    <span class="st">"ENSG00000143320_CRABP2"</span>,</span>
<span>    <span class="st">"ENSG00000145681_HAPLN1"</span>,</span>
<span>    <span class="st">"ENSG00000113196_HAND1"</span>,</span>
<span>    <span class="st">"ENSG00000198300_PEG3"</span>,</span>
<span>    <span class="st">"ENSG00000101144_BMP7"</span>,</span>
<span>    <span class="st">"ENSG00000174498_IGDCC3"</span>,</span>
<span>    <span class="st">"ENSG00000132005_RFX1"</span>,</span>
<span>    <span class="st">"ENSG00000099814_CEP170B"</span>,</span>
<span>    <span class="st">"ENSG00000101986_ABCD1"</span>,</span>
<span>    <span class="st">"ENSG00000144648_ACKR2"</span>,</span>
<span>    <span class="st">"ENSG00000074410_CA12"</span>,</span>
<span>    <span class="st">"ENSG00000125740_FOSB"</span>,</span>
<span>    <span class="st">"ENSG00000183979_NPB"</span>,</span>
<span>    <span class="st">"ENSG00000214049_UCA1"</span>,</span>
<span>    <span class="st">"ENSG00000153071_DAB2"</span>,</span>
<span>    <span class="st">"ENSG00000126353_CCR7"</span>,</span>
<span>    <span class="st">"ENSG00000105880_DLX5"</span>,</span>
<span>    <span class="st">"ENSG00000124749_COL21A1"</span>,</span>
<span>    <span class="st">"ENSG00000112041_TULP1"</span>,</span>
<span>    <span class="st">"ENSG00000120211_INSL4"</span>,</span>
<span>    <span class="st">"ENSG00000223850_MYCNUT"</span>,</span>
<span>    <span class="st">"ENSG00000164707_SLC13A4"</span>,</span>
<span>    <span class="st">"ENSG00000173157_ADAMTS20"</span>,</span>
<span>    <span class="st">"ENSG00000196482_ESRRG"</span>,</span>
<span>    <span class="st">"ENSG00000180875_GREM2"</span>,</span>
<span>    <span class="st">"ENSG00000170255_MRGPRX1"</span>,</span>
<span>    <span class="st">"ENSG00000267943_AC010328.1"</span>,</span>
<span>    <span class="st">"ENSG00000172818_OVOL1"</span>,</span>
<span>    <span class="st">"ENSG00000137270_GCM1"</span>,</span>
<span>    <span class="st">"ENSG00000137869_CYP19A1"</span>,</span>
<span>    <span class="st">"ENSG00000135678_CPM"</span>,</span>
<span>    <span class="st">"ENSG00000171476_HOPX"</span>,</span>
<span>    <span class="st">"ENSG00000249861_LGALS16"</span>,</span>
<span>    <span class="st">"ENSG00000108244_KRT23"</span>,</span>
<span>    <span class="st">"ENSG00000169550_MUC15"</span>,</span>
<span>    <span class="st">"ENSG00000260034_LCMT1-AS2"</span>,</span>
<span>    <span class="st">"ENSG00000269526_ERVV-1"</span>,</span>
<span>    <span class="st">"ENSG00000028137_TNFRSF1B"</span>,</span>
<span>    <span class="st">"ENSG00000124731_TREM1"</span>,</span>
<span>    <span class="st">"ENSG00000072422_RHOBTB1"</span>,</span>
<span>    <span class="st">"ENSG00000185215_TNFAIP2"</span>,</span>
<span>    <span class="st">"ENSG00000164877_MICALL2"</span>,</span>
<span>    <span class="st">"ENSG00000244476_ERVFRD-1"</span>,</span>
<span>    <span class="st">"ENSG00000280109_PLAC4"</span>,</span>
<span>    <span class="st">"ENSG00000111057_KRT18"</span>,</span>
<span>    <span class="st">"ENSG00000170421_KRT8"</span>,</span>
<span>    <span class="st">"ENSG00000169583_CLIC3"</span>,</span>
<span>    <span class="st">"ENSG00000107485_GATA3"</span>,</span>
<span>    <span class="st">"ENSG00000179348_GATA2"</span>,</span>
<span>    <span class="st">"ENSG00000187186_AL162231.1"</span>,</span>
<span>    <span class="st">"ENSG00000176155_CCDC57"</span>,</span>
<span>    <span class="st">"ENSG00000133243_BTBD2"</span>,</span>
<span>    <span class="st">"ENSG00000179364_PACS2"</span>,</span>
<span>    <span class="st">"ENSG00000237651_C2orf74"</span>,</span>
<span>    <span class="st">"ENSG00000125726_CD70"</span>,</span>
<span>    <span class="st">"ENSG00000156587_UBE2L6"</span>,</span>
<span>    <span class="st">"ENSG00000182165_TP53TG1"</span>,</span>
<span>    <span class="st">"ENSG00000163017_ACTG2"</span>,</span>
<span>    <span class="st">"ENSG00000143632_ACTA1"</span>,</span>
<span>    <span class="st">"ENSG00000119632_IFI27L2"</span>,</span>
<span>    <span class="st">"ENSG00000185847_LINC01405"</span>,</span>
<span>    <span class="st">"ENSG00000116661_FBXO2"</span>,</span>
<span>    <span class="st">"ENSG00000196878_LAMB3"</span>,</span>
<span>    <span class="st">"ENSG00000122861_PLAU"</span>,</span>
<span>    <span class="st">"ENSG00000142227_EMP3"</span>,</span>
<span>    <span class="st">"ENSG00000011422_PLAUR"</span>,</span>
<span>    <span class="st">"ENSG00000100985_MMP9"</span>,</span>
<span>    <span class="st">"ENSG00000026508_CD44"</span>,</span>
<span>    <span class="st">"ENSG00000104368_PLAT"</span>,</span>
<span>    <span class="st">"ENSG00000164171_ITGA2"</span>,</span>
<span>    <span class="st">"ENSG00000101198_NKAIN4"</span>,</span>
<span>    <span class="st">"ENSG00000116774_OLFML3"</span>,</span>
<span>    <span class="st">"ENSG00000125398_SOX9"</span>,</span>
<span>    <span class="st">"ENSG00000124225_PMEPA1"</span>,</span>
<span>    <span class="st">"ENSG00000118785_SPP1"</span>,</span>
<span>    <span class="st">"ENSG00000163453_IGFBP7"</span>,</span>
<span>    <span class="st">"ENSG00000182871_COL18A1"</span>,</span>
<span>    <span class="st">"ENSG00000110925_CSRNP2"</span>,</span>
<span>    <span class="st">"ENSG00000165886_UBTD1"</span>,</span>
<span>    <span class="st">"ENSG00000115073_ACTR1B"</span>,</span>
<span>    <span class="st">"ENSG00000256288_AC022075.3"</span>,</span>
<span>    <span class="st">"ENSG00000228106_AL392172.1"</span>,</span>
<span>    <span class="st">"ENSG00000163577_EIF5A2"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># heatmap matrix</span></span>
<span><span class="va">clusters_selected_heatmap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">11</span>,</span>
<span>    <span class="fl">18</span>,</span>
<span>    <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">12</span>, <span class="fl">17</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">matrix_heatmap</span> <span class="op">&lt;-</span> <span class="fu">calc_cpm</span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">)</span><span class="op">[</span></span>
<span>    <span class="va">features_heatmap</span>,</span>
<span>    <span class="va">embedding</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>            <span class="va">louvain</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">clusters_selected_heatmap</span>,</span>
<span>            <span class="va">batch</span> <span class="op">!=</span> <span class="st">"PRJEB11202"</span></span>
<span>        <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">cell</span><span class="op">)</span></span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="va">matrix_heatmap</span> <span class="op">&lt;-</span> <span class="va">matrix_heatmap</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">matrix_heatmap</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">0</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">matrix_heatmap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">matrix_heatmap</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">matrix_heatmap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">matrix_heatmap</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">heatmap_limits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">matrix_heatmap</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">matrix_heatmap</span><span class="op">[</span><span class="va">matrix_heatmap</span> <span class="op">&lt;</span> <span class="va">heatmap_limits</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">heatmap_limits</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">matrix_heatmap</span><span class="op">[</span><span class="va">matrix_heatmap</span> <span class="op">&gt;</span> <span class="va">heatmap_limits</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">heatmap_limits</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># sample cells</span></span>
<span><span class="va">cells_heatmap_sampled</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">clusters_selected_heatmap</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">cells_in_group</span> <span class="op">&lt;-</span> <span class="va">embedding</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>            <span class="va">louvain</span> <span class="op">==</span> <span class="va">x</span>,</span>
<span>            <span class="va">batch</span> <span class="op">!=</span> <span class="st">"PRJEB11202"</span></span>
<span>        <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">cell</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cells_in_group</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cells_in_group</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">cells_in_group</span>, <span class="fl">100</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">c</span> <span class="op">&lt;-</span> <span class="va">cells_in_group</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">c</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">## 312 </span></span>
<span><span class="co">## 51 </span></span>
<span><span class="co">## 1428 </span></span>
<span><span class="co">## 682 </span></span>
<span><span class="co">## 528 </span></span>
<span><span class="co">## 376 </span></span>
<span><span class="co">## 310 </span></span>
<span><span class="co">## 97</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cells_heatmap_sampled</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">clusters_selected_heatmap</span></span>
<span></span>
<span><span class="co"># cells</span></span>
<span><span class="va">clusters_EPI</span> <span class="op">&lt;-</span> <span class="fl">11</span></span>
<span><span class="va">clusters_HYP</span> <span class="op">&lt;-</span> <span class="fl">18</span></span>
<span><span class="va">clusters_TE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">12</span>, <span class="fl">17</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cells_heatmap_EPI</span> <span class="op">&lt;-</span> <span class="va">embedding</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">batch</span> <span class="op">!=</span> <span class="st">"PRJEB11202"</span>,</span>
<span>        <span class="va">louvain</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">clusters_EPI</span>,</span>
<span>        <span class="va">cell</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">cells_heatmap_sampled</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">cell</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cells_heatmap_HYP</span> <span class="op">&lt;-</span> <span class="va">embedding</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">batch</span> <span class="op">!=</span> <span class="st">"PRJEB11202"</span>,</span>
<span>        <span class="va">louvain</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">clusters_HYP</span>,</span>
<span>        <span class="va">cell</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">cells_heatmap_sampled</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">cell</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cells_heatmap_TE</span> <span class="op">&lt;-</span> <span class="va">cells_heatmap_sampled</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">clusters_TE</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_int</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">cells_heatmap_EPI</span>, <span class="va">cells_heatmap_HYP</span>, <span class="va">cells_heatmap_TE</span><span class="op">)</span>,</span>
<span>    <span class="va">length</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## [1] 100  51 597</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># column annotation</span></span>
<span><span class="va">ha_cluster</span> <span class="op">&lt;-</span> <span class="va">embedding</span><span class="op">[</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">cells_heatmap_sampled</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        table <span class="op">=</span> <span class="va">embedding</span><span class="op">$</span><span class="va">cell</span></span>
<span>    <span class="op">)</span>, <span class="st">"louvain"</span>,</span>
<span>    drop <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="va">ha_lineage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"TE"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ha_cluster</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ha_lineage</span><span class="op">[</span><span class="va">ha_cluster</span> <span class="op">==</span> <span class="st">"11"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"EPI"</span></span>
<span><span class="va">ha_lineage</span><span class="op">[</span><span class="va">ha_cluster</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"18"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"HYP"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># map color</span></span>
<span><span class="va">col_fun</span> <span class="op">&lt;-</span> <span class="fu">circlize</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html">colorRamp2</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">matrix_heatmap</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">matrix_heatmap</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html">plasma</a></span><span class="op">(</span><span class="fl">11</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># features to mark</span></span>
<span><span class="va">features_to_mark_left</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"ENSG00000184344_GDF3"</span>,</span>
<span>    <span class="st">"ENSG00000241186_TDGF1"</span>,</span>
<span>    <span class="st">"ENSG00000156574_NODAL"</span>,</span>
<span>    <span class="st">"ENSG00000066468_FGFR2"</span>,</span>
<span>    <span class="st">"ENSG00000111704_NANOG"</span>,</span>
<span>    <span class="st">"ENSG00000204531_POU5F1"</span>,</span>
<span>    <span class="st">"ENSG00000203909_DPPA5"</span>,</span>
<span>    <span class="st">"ENSG00000181449_SOX2"</span>,</span>
<span>    <span class="st">"ENSG00000186103_ARGFX"</span>,</span>
<span>    <span class="st">"ENSG00000147596_PRDM14"</span>,</span>
<span>    <span class="st">"ENSG00000171872_KLF17"</span>,</span>
<span>    <span class="st">"ENSG00000086548_CEACAM6"</span>,</span>
<span>    <span class="st">"ENSG00000166073_GPR176"</span>,</span>
<span>    <span class="st">"ENSG00000125740_FOSB"</span>,</span>
<span>    <span class="st">"ENSG00000105880_DLX5"</span>,</span>
<span>    <span class="st">"ENSG00000169583_CLIC3"</span>,</span>
<span>    <span class="st">"ENSG00000244476_ERVFRD-1"</span>,</span>
<span>    <span class="st">"ENSG00000072422_RHOBTB1"</span>,</span>
<span>    <span class="st">"ENSG00000137869_CYP19A1"</span>,</span>
<span>    <span class="st">"ENSG00000169550_MUC15"</span>,</span>
<span>    <span class="st">"ENSG00000108244_KRT23"</span>,</span>
<span>    <span class="st">"ENSG00000260034_LCMT1-AS2"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">features_to_mark_right</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"ENSG00000187498_COL4A1"</span>,</span>
<span>    <span class="st">"ENSG00000136574_GATA4"</span>,</span>
<span>    <span class="st">"ENSG00000115414_FN1"</span>,</span>
<span>    <span class="st">"ENSG00000125798_FOXA2"</span>,</span>
<span>    <span class="st">"ENSG00000164736_SOX17"</span>,</span>
<span>    <span class="st">"ENSG00000141448_GATA6"</span>,</span>
<span>    <span class="st">"ENSG00000275410_HNF1B"</span>,</span>
<span>    <span class="st">"ENSG00000153707_PTPRD"</span>,</span>
<span>    <span class="st">"ENSG00000101441_CST4"</span>,</span>
<span>    <span class="st">"ENSG00000146374_RSPO3"</span>,</span>
<span>    <span class="st">"ENSG00000111057_KRT18"</span>,</span>
<span>    <span class="st">"ENSG00000170421_KRT8"</span>,</span>
<span>    <span class="st">"ENSG00000153071_DAB2"</span>,</span>
<span>    <span class="st">"ENSG00000107485_GATA3"</span>,</span>
<span>    <span class="st">"ENSG00000179348_GATA2"</span>,</span>
<span>    <span class="st">"ENSG00000144648_ACKR2"</span>,</span>
<span>    <span class="st">"ENSG00000126353_CCR7"</span>,</span>
<span>    <span class="st">"ENSG00000137270_GCM1"</span>,</span>
<span>    <span class="st">"ENSG00000180875_GREM2"</span>,</span>
<span>    <span class="st">"ENSG00000172818_OVOL1"</span>,</span>
<span>    <span class="st">"ENSG00000265107_GJA5"</span>,</span>
<span>    <span class="st">"ENSG00000132470_ITGB4"</span>,</span>
<span>    <span class="st">"ENSG00000074410_CA12"</span>,</span>
<span>    <span class="st">"ENSG00000124749_COL21A1"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#</span></span>
<span><span class="va">features_to_mark_left</span> <span class="op">&lt;-</span> <span class="va">features_to_mark_left</span><span class="op">[</span></span>
<span>    <span class="va">features_to_mark_left</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">matrix_heatmap</span><span class="op">)</span></span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="va">ha_left</span> <span class="op">&lt;-</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/rowAnnotation.html">rowAnnotation</a></span><span class="op">(</span></span>
<span>    foo <span class="op">=</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/anno_mark.html">anno_mark</a></span><span class="op">(</span></span>
<span>        at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">matrix_heatmap</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">features_to_mark_left</span><span class="op">)</span>,</span>
<span>        labels <span class="op">=</span> <span class="va">features_to_mark_left</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"E.+_"</span><span class="op">)</span>,</span>
<span>        which <span class="op">=</span> <span class="st">"row"</span>,</span>
<span>        side <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>        lines_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span>,</span>
<span>        labels_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span></span>
<span>            fontfamily <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>            fontsize <span class="op">=</span> <span class="fl">5</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#</span></span>
<span><span class="va">features_to_mark_right</span> <span class="op">&lt;-</span> <span class="va">features_to_mark_right</span><span class="op">[</span></span>
<span>    <span class="va">features_to_mark_right</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">matrix_heatmap</span><span class="op">)</span></span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="va">ha_right</span> <span class="op">&lt;-</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/rowAnnotation.html">rowAnnotation</a></span><span class="op">(</span></span>
<span>    foo <span class="op">=</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/anno_mark.html">anno_mark</a></span><span class="op">(</span></span>
<span>        at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">matrix_heatmap</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">features_to_mark_right</span><span class="op">)</span>,</span>
<span>        labels <span class="op">=</span> <span class="va">features_to_mark_right</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"E.+_"</span><span class="op">)</span>,</span>
<span>        which <span class="op">=</span> <span class="st">"row"</span>,</span>
<span>        side <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>        lines_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"grey50"</span><span class="op">)</span>,</span>
<span>        labels_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span></span>
<span>            fontfamily <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>            fontsize <span class="op">=</span> <span class="fl">5</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">RASTERISED</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># EPI</span></span>
<span><span class="va">anno_labels_tbl_EPI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span></span>
<span>    <span class="va">ha_cluster</span><span class="op">[</span><span class="va">ha_cluster</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">clusters_EPI</span><span class="op">]</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">clusters_EPI</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        cum_sum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,</span>
<span>        position <span class="op">=</span> <span class="va">cum_sum</span> <span class="op">-</span> <span class="va">value</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">anno_labels_cluster_EPI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span></span>
<span>    <span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ha_cluster</span><span class="op">[</span><span class="va">ha_cluster</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">clusters_EPI</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">clusters_EPI</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">cluster_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">clusters_EPI</span><span class="op">)</span>, <span class="st">""</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>    <span class="va">anno_labels_cluster_EPI</span><span class="op">[</span></span>
<span>        <span class="va">anno_labels_tbl_EPI</span><span class="op">$</span><span class="va">position</span> <span class="op">-</span> <span class="fl">5</span></span>
<span>    <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cluster_label</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">anno_labels_cluster_EPI</span><span class="op">[</span></span>
<span>        <span class="va">anno_labels_tbl_EPI</span><span class="op">$</span><span class="va">position</span> <span class="op">+</span> <span class="fl">5</span></span>
<span>    <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cluster_label</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">anno_labels_cluster_EPI</span><span class="op">[</span><span class="va">anno_labels_tbl_EPI</span><span class="op">$</span><span class="va">position</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span></span>
<span>        <span class="va">clusters_EPI</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">ha_column_EPI</span> <span class="op">&lt;-</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/HeatmapAnnotation.html">HeatmapAnnotation</a></span><span class="op">(</span></span>
<span>    <span class="co">#</span></span>
<span>    lineage <span class="op">=</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/anno_simple.html">anno_simple</a></span><span class="op">(</span></span>
<span>        <span class="va">ha_lineage</span><span class="op">[</span><span class="va">ha_lineage</span> <span class="op">==</span> <span class="st">"EPI"</span><span class="op">]</span>,</span>
<span>        <span class="co"># pch = anno_labels_cluster,</span></span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span></span>
<span>            object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey85"</span>, <span class="st">"#8ace7e"</span>, <span class="st">"#ff684c"</span>, <span class="st">"#9467bd"</span>, <span class="st">"#ffd8b1"</span><span class="op">)</span>,</span>
<span>            nm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Blastoid"</span>, <span class="st">"EPI"</span>, <span class="st">"HYP"</span>, <span class="st">"TE"</span>, <span class="st">"n/a"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        which <span class="op">=</span> <span class="st">"column"</span>,</span>
<span>        pt_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span>,</span>
<span>        pt_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span></span>
<span>            fontfamily <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>            fontsize <span class="op">=</span> <span class="fl">5</span></span>
<span>        <span class="op">)</span>,</span>
<span>        simple_anno_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co">#</span></span>
<span>    cluster <span class="op">=</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/anno_simple.html">anno_simple</a></span><span class="op">(</span></span>
<span>        <span class="va">ha_cluster</span><span class="op">[</span><span class="va">ha_cluster</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">clusters_EPI</span><span class="op">]</span>,</span>
<span>        pch <span class="op">=</span> <span class="va">anno_labels_cluster_EPI</span>,</span>
<span>        col <span class="op">=</span> <span class="va">color_palette_cluster</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">clusters_selected_heatmap</span><span class="op">)</span><span class="op">]</span>,</span>
<span>        which <span class="op">=</span> <span class="st">"column"</span>,</span>
<span>        <span class="co"># pt_size = unit(2, "mm"),</span></span>
<span>        pt_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span></span>
<span>            fontfamily <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>            fontsize <span class="op">=</span> <span class="fl">5</span></span>
<span>        <span class="op">)</span>,</span>
<span>        simple_anno_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co">#</span></span>
<span>    show_annotation_name <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    annotation_label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Lineage"</span>,</span>
<span>        <span class="st">"Cluster"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    annotation_name_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>fontfamily <span class="op">=</span> <span class="st">"Arial"</span>, fontsize <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>    annotation_name_side <span class="op">=</span> <span class="st">"left"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ht_EPI</span> <span class="op">&lt;-</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span></span>
<span>    matrix <span class="op">=</span> <span class="va">matrix_heatmap</span><span class="op">[</span>, <span class="va">cells_heatmap_EPI</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    rect_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>col <span class="op">=</span> <span class="cn">NA</span>, lwd <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="va">col_fun</span>,</span>
<span>    <span class="co">#</span></span>
<span>    row_title_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>fontfamily <span class="op">=</span> <span class="st">"Arial"</span>, fontsize <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>    row_title_rot <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    column_title_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>fontfamily <span class="op">=</span> <span class="st">"Arial"</span>, fontsize <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>    column_title_rot <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    <span class="co">#</span></span>
<span>    cluster_rows <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    show_row_dend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    cluster_columns <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    show_column_dend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    <span class="co">#</span></span>
<span>    show_row_names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    show_column_names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    <span class="co">#</span></span>
<span>    top_annotation <span class="op">=</span> <span class="va">ha_column_EPI</span>,</span>
<span>    bottom_annotation <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    left_annotation <span class="op">=</span> <span class="va">ha_left</span>,</span>
<span>    right_annotation <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    <span class="co">#</span></span>
<span>    column_split <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>        <span class="va">ha_lineage</span><span class="op">[</span><span class="va">ha_lineage</span> <span class="op">==</span> <span class="st">"EPI"</span><span class="op">]</span>,</span>
<span>        levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">ha_lineage</span><span class="op">[</span><span class="va">ha_lineage</span> <span class="op">==</span> <span class="st">"EPI"</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    column_gap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"mm"</span><span class="op">)</span>,</span>
<span>    <span class="co">#</span></span>
<span>    show_heatmap_legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    heatmap_legend_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>        <span class="co"># title = expression(paste("Log"[10], " (CPM + 1)")),</span></span>
<span>        title <span class="op">=</span> <span class="st">"Expr"</span>,</span>
<span>        title_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span></span>
<span>            fontfamily <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>            fontsize <span class="op">=</span> <span class="fl">6</span></span>
<span>        <span class="op">)</span>,</span>
<span>        legend_direction <span class="op">=</span> <span class="st">"vertical"</span>,</span>
<span>        labels_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span></span>
<span>            fontfamily <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>            fontsize <span class="op">=</span> <span class="fl">5</span></span>
<span>        <span class="op">)</span>,</span>
<span>        legend_height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">15</span>, <span class="st">"mm"</span><span class="op">)</span>,</span>
<span>        legend_width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">5</span>, <span class="st">"mm"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co">#</span></span>
<span>    use_raster <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    <span class="co">#</span></span>
<span>    width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">8</span>, <span class="st">"mm"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># ComplexHeatmap::draw(ht_EPI)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># HYP</span></span>
<span><span class="va">anno_labels_tbl_HYP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span></span>
<span>    <span class="va">ha_cluster</span><span class="op">[</span><span class="va">ha_cluster</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">clusters_HYP</span><span class="op">]</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">clusters_HYP</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        cum_sum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,</span>
<span>        position <span class="op">=</span> <span class="va">cum_sum</span> <span class="op">-</span> <span class="va">value</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">anno_labels_cluster_HYP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span></span>
<span>    <span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ha_cluster</span><span class="op">[</span><span class="va">ha_cluster</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">clusters_HYP</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">clusters_HYP</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">cluster_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">clusters_HYP</span><span class="op">)</span>, <span class="st">""</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>    <span class="va">anno_labels_cluster_HYP</span><span class="op">[</span></span>
<span>        <span class="va">anno_labels_tbl_HYP</span><span class="op">$</span><span class="va">position</span> <span class="op">-</span> <span class="fl">5</span></span>
<span>    <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cluster_label</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">anno_labels_cluster_HYP</span><span class="op">[</span></span>
<span>        <span class="va">anno_labels_tbl_HYP</span><span class="op">$</span><span class="va">position</span> <span class="op">+</span> <span class="fl">5</span></span>
<span>    <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cluster_label</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">anno_labels_cluster_HYP</span><span class="op">[</span></span>
<span>        <span class="va">anno_labels_tbl_HYP</span><span class="op">$</span><span class="va">position</span></span>
<span>    <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">clusters_HYP</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">ha_column_HYP</span> <span class="op">&lt;-</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/HeatmapAnnotation.html">HeatmapAnnotation</a></span><span class="op">(</span></span>
<span>    <span class="co">#</span></span>
<span>    lineage <span class="op">=</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/anno_simple.html">anno_simple</a></span><span class="op">(</span></span>
<span>        <span class="va">ha_lineage</span><span class="op">[</span><span class="va">ha_lineage</span> <span class="op">==</span> <span class="st">"HYP"</span><span class="op">]</span>,</span>
<span>        <span class="co"># pch = anno_labels_cluster,</span></span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span></span>
<span>            object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey85"</span>, <span class="st">"#8ace7e"</span>, <span class="st">"#ff684c"</span>, <span class="st">"#9467bd"</span>, <span class="st">"#ffd8b1"</span><span class="op">)</span>,</span>
<span>            nm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Blastoid"</span>, <span class="st">"EPI"</span>, <span class="st">"HYP"</span>, <span class="st">"TE"</span>, <span class="st">"n/a"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        which <span class="op">=</span> <span class="st">"column"</span>,</span>
<span>        pt_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span>,</span>
<span>        pt_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span></span>
<span>            fontfamily <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>            fontsize <span class="op">=</span> <span class="fl">5</span></span>
<span>        <span class="op">)</span>,</span>
<span>        simple_anno_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co">#</span></span>
<span>    cluster <span class="op">=</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/anno_simple.html">anno_simple</a></span><span class="op">(</span></span>
<span>        <span class="va">ha_cluster</span><span class="op">[</span><span class="va">ha_cluster</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">clusters_HYP</span><span class="op">]</span>,</span>
<span>        pch <span class="op">=</span> <span class="va">anno_labels_cluster_HYP</span>,</span>
<span>        col <span class="op">=</span> <span class="va">color_palette_cluster</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">clusters_selected_heatmap</span><span class="op">)</span><span class="op">]</span>,</span>
<span>        which <span class="op">=</span> <span class="st">"column"</span>,</span>
<span>        <span class="co"># pt_size = unit(2, "mm"),</span></span>
<span>        pt_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span></span>
<span>            fontfamily <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>            fontsize <span class="op">=</span> <span class="fl">5</span></span>
<span>        <span class="op">)</span>,</span>
<span>        simple_anno_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co">#</span></span>
<span>    show_annotation_name <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    annotation_label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Lineage"</span>,</span>
<span>        <span class="st">"Cluster"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    annotation_name_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>fontfamily <span class="op">=</span> <span class="st">"Arial"</span>, fontsize <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>    annotation_name_side <span class="op">=</span> <span class="st">"left"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ht_HYP</span> <span class="op">&lt;-</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span></span>
<span>    matrix <span class="op">=</span> <span class="va">matrix_heatmap</span><span class="op">[</span>, <span class="va">cells_heatmap_HYP</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    rect_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>col <span class="op">=</span> <span class="cn">NA</span>, lwd <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="va">col_fun</span>,</span>
<span>    <span class="co">#</span></span>
<span>    row_title_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>fontfamily <span class="op">=</span> <span class="st">"Arial"</span>, fontsize <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>    row_title_rot <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    column_title_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>fontfamily <span class="op">=</span> <span class="st">"Arial"</span>, fontsize <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>    column_title_rot <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    <span class="co">#</span></span>
<span>    cluster_rows <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    show_row_dend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    cluster_columns <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    show_column_dend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    <span class="co">#</span></span>
<span>    show_row_names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    show_column_names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    <span class="co">#</span></span>
<span>    top_annotation <span class="op">=</span> <span class="va">ha_column_HYP</span>,</span>
<span>    bottom_annotation <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    left_annotation <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    right_annotation <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    <span class="co">#</span></span>
<span>    <span class="co"># row_split = table_s2_sheet4$ClusterID,</span></span>
<span>    <span class="co"># row_gap = unit(0.3, "mm"),</span></span>
<span>    column_split <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>        <span class="va">ha_lineage</span><span class="op">[</span><span class="va">ha_lineage</span> <span class="op">==</span> <span class="st">"HYP"</span><span class="op">]</span>,</span>
<span>        levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">ha_lineage</span><span class="op">[</span><span class="va">ha_lineage</span> <span class="op">==</span> <span class="st">"HYP"</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    column_gap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"mm"</span><span class="op">)</span>,</span>
<span>    <span class="co">#</span></span>
<span>    show_heatmap_legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    heatmap_legend_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>        <span class="co"># title = expression(paste("Log"[10], " (CPM + 1)")),</span></span>
<span>        title <span class="op">=</span> <span class="st">"Expr"</span>,</span>
<span>        title_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span></span>
<span>            fontfamily <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>            fontsize <span class="op">=</span> <span class="fl">6</span></span>
<span>        <span class="op">)</span>,</span>
<span>        legend_direction <span class="op">=</span> <span class="st">"vertical"</span>,</span>
<span>        labels_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span></span>
<span>            fontfamily <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>            fontsize <span class="op">=</span> <span class="fl">5</span></span>
<span>        <span class="op">)</span>,</span>
<span>        legend_height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">15</span>, <span class="st">"mm"</span><span class="op">)</span>,</span>
<span>        legend_width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">5</span>, <span class="st">"mm"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co">#</span></span>
<span>    use_raster <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    <span class="co">#</span></span>
<span>    width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">5</span>, <span class="st">"mm"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># ComplexHeatmap::draw(ht_HYP)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># TE</span></span>
<span><span class="va">anno_labels_tbl_TE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span></span>
<span>    <span class="va">ha_cluster</span><span class="op">[</span><span class="va">ha_cluster</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">clusters_TE</span><span class="op">]</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">clusters_TE</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html">enframe</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        cum_sum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>,</span>
<span>        position <span class="op">=</span> <span class="va">cum_sum</span> <span class="op">-</span> <span class="va">value</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">anno_labels_tbl_TE</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">anno_labels_tbl_TE</span><span class="op">$</span><span class="va">name</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># works but ugly</span></span>
<span>    <span class="va">a</span> <span class="op">&lt;-</span> <span class="va">anno_labels_tbl_TE</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="va">x</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">a</span><span class="op">$</span><span class="va">name</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">cluster_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">a</span><span class="op">$</span><span class="va">name</span><span class="op">)</span>, <span class="st">""</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>        <span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">a</span><span class="op">)</span></span>
<span></span>
<span>        <span class="va">a</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cluster_label</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>        <span class="va">a</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">cluster_label</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>        <span class="va">a</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="va">a</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">-</span> <span class="fl">5</span></span>
<span>        <span class="va">a</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">+</span> <span class="fl">5</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">rbind</span><span class="op">)</span></span>
<span></span>
<span><span class="va">anno_labels_cluster_TE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span></span>
<span>    <span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ha_cluster</span><span class="op">[</span><span class="va">ha_cluster</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">clusters_TE</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">anno_labels_cluster_TE</span><span class="op">[</span><span class="va">anno_labels_tbl_TE</span><span class="op">$</span><span class="va">position</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">anno_labels_tbl_TE</span><span class="op">$</span><span class="va">name</span></span>
<span></span>
<span><span class="va">ha_column_TE</span> <span class="op">&lt;-</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/HeatmapAnnotation.html">HeatmapAnnotation</a></span><span class="op">(</span></span>
<span>    <span class="co">#</span></span>
<span>    lineage <span class="op">=</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/anno_simple.html">anno_simple</a></span><span class="op">(</span></span>
<span>        <span class="va">ha_lineage</span><span class="op">[</span><span class="va">ha_lineage</span> <span class="op">==</span> <span class="st">"TE"</span><span class="op">]</span>,</span>
<span>        <span class="co"># pch = anno_labels_cluster,</span></span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span></span>
<span>            object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey85"</span>, <span class="st">"#8ace7e"</span>, <span class="st">"#ff684c"</span>, <span class="st">"#9467bd"</span>, <span class="st">"#ffd8b1"</span><span class="op">)</span>,</span>
<span>            nm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Blastoid"</span>, <span class="st">"EPI"</span>, <span class="st">"HYP"</span>, <span class="st">"TE"</span>, <span class="st">"n/a"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        which <span class="op">=</span> <span class="st">"column"</span>,</span>
<span>        pt_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span>,</span>
<span>        pt_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span></span>
<span>            fontfamily <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>            fontsize <span class="op">=</span> <span class="fl">5</span></span>
<span>        <span class="op">)</span>,</span>
<span>        simple_anno_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co">#</span></span>
<span>    cluster <span class="op">=</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/anno_simple.html">anno_simple</a></span><span class="op">(</span></span>
<span>        <span class="va">ha_cluster</span><span class="op">[</span><span class="va">ha_cluster</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">clusters_TE</span><span class="op">]</span>,</span>
<span>        pch <span class="op">=</span> <span class="va">anno_labels_cluster_TE</span>,</span>
<span>        col <span class="op">=</span> <span class="va">color_palette_cluster</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">clusters_selected_heatmap</span><span class="op">)</span><span class="op">]</span>,</span>
<span>        which <span class="op">=</span> <span class="st">"column"</span>,</span>
<span>        <span class="co"># pt_size = unit(2, "mm"),</span></span>
<span>        pt_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span></span>
<span>            fontfamily <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>            fontsize <span class="op">=</span> <span class="fl">5</span></span>
<span>        <span class="op">)</span>,</span>
<span>        simple_anno_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co">#</span></span>
<span>    show_annotation_name <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    annotation_label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Lineage"</span>,</span>
<span>        <span class="st">"Cluster"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    annotation_name_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>fontfamily <span class="op">=</span> <span class="st">"Arial"</span>, fontsize <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>    annotation_name_side <span class="op">=</span> <span class="st">"left"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ht_TE</span> <span class="op">&lt;-</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html">Heatmap</a></span><span class="op">(</span></span>
<span>    matrix <span class="op">=</span> <span class="va">matrix_heatmap</span><span class="op">[</span>, <span class="va">cells_heatmap_TE</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    rect_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>col <span class="op">=</span> <span class="cn">NA</span>, lwd <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="va">col_fun</span>,</span>
<span>    <span class="co">#</span></span>
<span>    row_title_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>fontfamily <span class="op">=</span> <span class="st">"Arial"</span>, fontsize <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>    row_title_rot <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    column_title_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span>fontfamily <span class="op">=</span> <span class="st">"Arial"</span>, fontsize <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>    column_title_rot <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    <span class="co">#</span></span>
<span>    cluster_rows <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    show_row_dend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    cluster_columns <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    show_column_dend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    <span class="co">#</span></span>
<span>    show_row_names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    show_column_names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    <span class="co">#</span></span>
<span>    top_annotation <span class="op">=</span> <span class="va">ha_column_TE</span>,</span>
<span>    bottom_annotation <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    left_annotation <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    right_annotation <span class="op">=</span> <span class="va">ha_right</span>,</span>
<span>    <span class="co">#</span></span>
<span>    column_split <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>        <span class="va">ha_lineage</span><span class="op">[</span><span class="va">ha_lineage</span> <span class="op">==</span> <span class="st">"TE"</span><span class="op">]</span>,</span>
<span>        levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">ha_lineage</span><span class="op">[</span><span class="va">ha_lineage</span> <span class="op">==</span> <span class="st">"TE"</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    column_gap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"mm"</span><span class="op">)</span>,</span>
<span>    <span class="co">#</span></span>
<span>    show_heatmap_legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    heatmap_legend_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Expr"</span>,</span>
<span>        title_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span></span>
<span>            fontfamily <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>            fontsize <span class="op">=</span> <span class="fl">6</span></span>
<span>        <span class="op">)</span>,</span>
<span>        legend_direction <span class="op">=</span> <span class="st">"vertical"</span>,</span>
<span>        labels_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span></span>
<span>            fontfamily <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>            fontsize <span class="op">=</span> <span class="fl">5</span></span>
<span>        <span class="op">)</span>,</span>
<span>        legend_height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">15</span>, <span class="st">"mm"</span><span class="op">)</span>,</span>
<span>        legend_width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">5</span>, <span class="st">"mm"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co">#</span></span>
<span>    use_raster <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    <span class="co">#</span></span>
<span>    width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">50</span>, <span class="st">"mm"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># legend</span></span>
<span><span class="va">lgd_colorbar</span> <span class="op">&lt;-</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Legend.html">Legend</a></span><span class="op">(</span></span>
<span>    col_fun <span class="op">=</span> <span class="va">col_fun</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Expr"</span>,</span>
<span>    grid_height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"mm"</span><span class="op">)</span>,</span>
<span>    grid_width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span>,</span>
<span>    legend_height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"mm"</span><span class="op">)</span>,</span>
<span>    legend_width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span>,</span>
<span>    title_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span></span>
<span>        fontfamily <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>        fontsize <span class="op">=</span> <span class="fl">6</span></span>
<span>    <span class="op">)</span>,</span>
<span>    labels_gp <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span><span class="op">(</span></span>
<span>        fontfamily <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>        fontsize <span class="op">=</span> <span class="fl">5</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/packLegend.html">packLegend</a></span><span class="op">(</span></span>
<span>    <span class="va">lgd_colorbar</span>,</span>
<span>    <span class="co"># gap = unit(8, "mm"),</span></span>
<span>    direction <span class="op">=</span> <span class="st">"vertical"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-fig.dpi="300">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html">draw</a></span><span class="op">(</span></span>
<span>    <span class="va">ht_EPI</span> <span class="op">+</span> <span class="va">ht_HYP</span> <span class="op">+</span> <span class="va">ht_TE</span>,</span>
<span>    heatmap_legend_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">pd</span><span class="op">)</span>,</span>
<span>    ht_gap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"mm"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="analyze_blastoids_files/figure-html/unnamed-chunk-42-1.png" style="width:100.0%;height:100.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section><section id="gene-ontology-enrichment" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="gene-ontology-enrichment">Gene Ontology enrichment</h3>
<div class="cell">

</div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">enriched_go</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>    <span class="op">~</span><span class="va">category</span>, <span class="op">~</span><span class="va">rank</span>, <span class="op">~</span><span class="va">go_id</span>, <span class="op">~</span><span class="va">term</span>, <span class="op">~</span><span class="va">p_value</span>, <span class="op">~</span><span class="va">p_value_log</span>,</span>
<span>    <span class="st">"EPI"</span>, <span class="fl">1L</span>, <span class="st">"GO:0019827"</span>, <span class="st">"stem cell population maintenance"</span>, <span class="fl">9e-07</span>, <span class="fl">6.045757491</span>,</span>
<span>    <span class="st">"EPI"</span>, <span class="fl">2L</span>, <span class="st">"GO:0048368"</span>, <span class="st">"lateral mesoderm development"</span>, <span class="fl">0.00053</span>, <span class="fl">3.27572413</span>,</span>
<span>    <span class="st">"EPI"</span>, <span class="fl">3L</span>, <span class="st">"GO:0009790"</span>, <span class="st">"embryo development"</span>, <span class="fl">0.00088</span>, <span class="fl">3.055517328</span>,</span>
<span>    <span class="st">"HYP"</span>, <span class="fl">1L</span>, <span class="st">"GO:0048598"</span>, <span class="st">"embryonic morphogenesis"</span>, <span class="fl">3.9e-07</span>, <span class="fl">6.408935393</span>,</span>
<span>    <span class="st">"HYP"</span>, <span class="fl">2L</span>, <span class="st">"GO:0007369"</span>, <span class="st">"gastrulation"</span>, <span class="fl">1.8e-05</span>, <span class="fl">4.744727495</span>,</span>
<span>    <span class="st">"HYP"</span>, <span class="fl">3L</span>, <span class="st">"GO:0007492"</span>, <span class="st">"endoderm development"</span>, <span class="fl">0.00284</span>, <span class="fl">2.54668166</span>,</span>
<span>    <span class="st">"TE"</span>, <span class="fl">1L</span>, <span class="st">"GO:0001890"</span>, <span class="st">"placenta development"</span>, <span class="fl">6e-11</span>, <span class="fl">10.22184875</span>,</span>
<span>    <span class="st">"TE"</span>, <span class="fl">2L</span>, <span class="st">"GO:0001892"</span>, <span class="st">"embryonic placenta development"</span>, <span class="fl">2e-08</span>, <span class="fl">7.698970004</span>,</span>
<span>    <span class="st">"TE"</span>, <span class="fl">3L</span>, <span class="st">"GO:0048513"</span>, <span class="st">"animal organ development"</span>, <span class="fl">2.7e-07</span>, <span class="fl">6.568636236</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">enriched_go</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        category <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>            <span class="va">category</span>,</span>
<span>            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"EPI"</span>, <span class="st">"HYP"</span>, <span class="st">"TE"</span><span class="op">)</span> <span class="co">#  |&gt; rev()</span></span>
<span>        <span class="op">)</span>,</span>
<span>        rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>            <span class="va">rank</span>,</span>
<span>            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">plot_barplot_go_enrichment</span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">p_value_log</span>,</span>
<span>        y <span class="op">=</span> <span class="va">rank</span>,</span>
<span>        z <span class="op">=</span> <span class="va">category</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span></span>
<span>        <span class="op">~</span><span class="va">category</span>,</span>
<span>        nrow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        strip.position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>        scales <span class="op">=</span> <span class="st">"free_x"</span>,</span>
<span>        labeller <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html">labeller</a></span><span class="op">(</span></span>
<span>            category <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"EPI"</span> <span class="op">=</span> <span class="st">"EPI"</span>, <span class="st">"HYP"</span> <span class="op">=</span> <span class="st">"HYP"</span>, <span class="st">"TE"</span> <span class="op">=</span> <span class="st">"TE"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span></span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>            x <span class="op">=</span> <span class="fl">0</span>,</span>
<span>            label <span class="op">=</span> <span class="va">term</span>,</span>
<span>            group <span class="op">=</span> <span class="cn">NULL</span></span>
<span>        <span class="op">)</span>,</span>
<span>        size <span class="op">=</span> <span class="fl">2.2</span>,</span>
<span>        family <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        data <span class="op">=</span> <span class="va">enriched_go</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>                category <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>                    <span class="va">category</span>,</span>
<span>                    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"EPI"</span>, <span class="st">"HYP"</span>, <span class="st">"TE"</span><span class="op">)</span></span>
<span>                <span class="op">)</span>,</span>
<span>                rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>                    <span class="va">rank</span>,</span>
<span>                    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>                <span class="op">)</span>,</span>
<span>                term <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">" "</span>, <span class="va">term</span><span class="op">)</span></span>
<span>            <span class="op">)</span>,</span>
<span>        hjust <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span></span>
<span>        values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#8ace7e"</span>, <span class="st">"#ff684c"</span>, <span class="st">"#9467bd"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display column-body-outset">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="analyze_blastoids_files/figure-html/unnamed-chunk-44-1.png" style="width:100.0%;height:100.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="high-concordance-of-blastoid-replicates" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="high-concordance-of-blastoid-replicates">High concordance of blastoid replicates</h2>
<div class="cell">

</div>
<section id="data-loading" class="level3"><h3 class="anchored" data-anchor-id="data-loading">Data loading</h3>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">EMBEDDING_FILE</span> <span class="op">&lt;-</span> <span class="st">"embedding_replicate.csv.gz"</span></span>
<span></span>
<span><span class="va">embedding_replicate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span></span>
<span>    file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">PROJECT_DIR</span>, <span class="st">"github"</span>, <span class="st">"data"</span>, <span class="va">EMBEDDING_FILE</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">cell</span><span class="op">:</span><span class="va">y_fitsne</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># clean up</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">EMBEDDING_FILE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MATRIX_DIR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"github/data/matrices/LW36"</span>,</span>
<span>    <span class="st">"github/data/matrices/LW49_LW50_LW51_LW52"</span>,</span>
<span>    <span class="st">"github/data/matrices/LW58_LW59"</span>,</span>
<span>    <span class="st">"github/data/matrices/LW60_LW61"</span>,</span>
<span>    <span class="st">"raw/public/PRJEB11202/reformatted_matrix"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">matrix_readcount_use</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">MATRIX_DIR</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">load_matrix</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">PROJECT_DIR</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">cbind</span><span class="op">)</span></span>
<span></span>
<span><span class="va">matrix_readcount_use</span> <span class="op">&lt;-</span> <span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">embedding_replicate</span><span class="op">$</span><span class="va">cell</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="embedding-visualization-1" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="embedding-visualization-1">Embedding visualization</h3>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">EMBEDDING_TITLE_PREFIX</span> <span class="op">&lt;-</span> <span class="st">"FIt-SNE"</span></span>
<span></span>
<span><span class="va">x_column</span> <span class="op">&lt;-</span> <span class="st">"x_fitsne"</span></span>
<span><span class="va">y_column</span> <span class="op">&lt;-</span> <span class="st">"y_fitsne"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="clustering-batch-umi-1" class="level4 page-columns page-full"><h4 class="anchored" data-anchor-id="clustering-batch-umi-1">Clustering &amp; batch &amp; UMI</h4>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p_embedding_replicate_louvain</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding_replicate</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="va">embedding_replicate</span><span class="op">$</span><span class="va">louvain</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{EMBEDDING_TITLE_PREFIX}; Cluster"</span><span class="op">)</span>,</span>
<span>    color_labels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    shuffle_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="va">GEOM_POINT_SIZE</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_embedding_replicate_batch</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding_replicate</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="va">embedding_replicate</span><span class="op">$</span><span class="va">batch</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{EMBEDDING_TITLE_PREFIX}; Batch"</span><span class="op">)</span>,</span>
<span>    color_labels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    shuffle_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="va">GEOM_POINT_SIZE</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">CB_POSITION</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.875</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">p_embedding_replicate_UMI</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding_replicate</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span></span>
<span>        <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html">colSums</a></span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">embedding_replicate</span><span class="op">$</span><span class="va">cell</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{EMBEDDING_TITLE_PREFIX}; UMI"</span><span class="op">)</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    shuffle_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="va">GEOM_POINT_SIZE</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">CB_POSITION</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>        y <span class="op">=</span> <span class="va">CB_POSITION</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">embedding_replicate</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        num_umis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html">colSums</a></span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">cell</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        num_features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html">colSums</a></span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">cell</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">batch</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>        num_cells <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        median_umis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">num_umis</span><span class="op">)</span>,</span>
<span>        median_features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">num_features</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        sample <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">batch</span> <span class="op">==</span> <span class="st">"LW36"</span> <span class="op">~</span> <span class="st">"Blastoid, D8; TH; 5i/L/A"</span>,</span>
<span>            <span class="va">batch</span> <span class="op">==</span> <span class="st">"LW60"</span> <span class="op">~</span> <span class="st">"Blastoid, D9; HT; 5i/L/A"</span>,</span>
<span>            <span class="va">batch</span> <span class="op">==</span> <span class="st">"LW61"</span> <span class="op">~</span> <span class="st">"Blastoid, D9; HT; PXGL"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>        <span class="va">sample</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/data_color.html">data_color</a></span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">median_umis</span><span class="op">)</span>,</span>
<span>        colors <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/col_numeric.html">col_numeric</a></span><span class="op">(</span></span>
<span>            palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                <span class="st">"green"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span></span>
<span>            <span class="op">)</span>,</span>
<span>            domain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7500</span>, <span class="fl">32000</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/summary_rows.html">summary_rows</a></span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sample</span>, <span class="va">batch</span><span class="op">)</span>,</span>
<span>        fns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>            Count <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        decimals <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/summary_rows.html">summary_rows</a></span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">median_umis</span><span class="op">:</span><span class="va">median_features</span><span class="op">)</span>,</span>
<span>        fns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>            Mean <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        decimals <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/summary_rows.html">summary_rows</a></span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">num_cells</span><span class="op">)</span>,</span>
<span>        fns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>            Sum <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        decimals <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/tab_header.html">tab_header</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/md.html">md</a></span><span class="op">(</span><span class="st">"**Clustering of TH- and HT-Blastoids**; Batch"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="womtvrcvrq" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

:where(#womtvrcvrq) .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

:where(#womtvrcvrq) .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#womtvrcvrq) .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

:where(#womtvrcvrq) .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

:where(#womtvrcvrq) .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#womtvrcvrq) .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#womtvrcvrq) .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

:where(#womtvrcvrq) .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

:where(#womtvrcvrq) .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

:where(#womtvrcvrq) .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

:where(#womtvrcvrq) .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

:where(#womtvrcvrq) .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

:where(#womtvrcvrq) .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

:where(#womtvrcvrq) .gt_from_md > :first-child {
  margin-top: 0;
}

:where(#womtvrcvrq) .gt_from_md > :last-child {
  margin-bottom: 0;
}

:where(#womtvrcvrq) .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

:where(#womtvrcvrq) .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#womtvrcvrq) .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

:where(#womtvrcvrq) .gt_row_group_first td {
  border-top-width: 2px;
}

:where(#womtvrcvrq) .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#womtvrcvrq) .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

:where(#womtvrcvrq) .gt_first_summary_row.thick {
  border-top-width: 2px;
}

:where(#womtvrcvrq) .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#womtvrcvrq) .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#womtvrcvrq) .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

:where(#womtvrcvrq) .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

:where(#womtvrcvrq) .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#womtvrcvrq) .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#womtvrcvrq) .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#womtvrcvrq) .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#womtvrcvrq) .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#womtvrcvrq) .gt_left {
  text-align: left;
}

:where(#womtvrcvrq) .gt_center {
  text-align: center;
}

:where(#womtvrcvrq) .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

:where(#womtvrcvrq) .gt_font_normal {
  font-weight: normal;
}

:where(#womtvrcvrq) .gt_font_bold {
  font-weight: bold;
}

:where(#womtvrcvrq) .gt_font_italic {
  font-style: italic;
}

:where(#womtvrcvrq) .gt_super {
  font-size: 65%;
}

:where(#womtvrcvrq) .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

:where(#womtvrcvrq) .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

:where(#womtvrcvrq) .gt_indent_1 {
  text-indent: 5px;
}

:where(#womtvrcvrq) .gt_indent_2 {
  text-indent: 10px;
}

:where(#womtvrcvrq) .gt_indent_3 {
  text-indent: 15px;
}

:where(#womtvrcvrq) .gt_indent_4 {
  text-indent: 20px;
}

:where(#womtvrcvrq) .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
<thead class="gt_header"><tr>
<td colspan="6" class="gt_heading gt_title gt_font_normal gt_bottom_border" style="">
<strong>Clustering of TH- and HT-Blastoids</strong>; Batch</td>
    </tr></thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=""></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="sample">sample</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="batch">batch</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="num_cells">num_cells</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="median_umis">median_umis</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="median_features">median_features</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<th id="stub_1_1" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_1 sample" class="gt_row gt_left">Blastoid, D8; TH; 5i/L/A</td>
<td headers="stub_1_1 batch" class="gt_row gt_left">LW36</td>
<td headers="stub_1_1 num_cells" class="gt_row gt_right">6854</td>
<td headers="stub_1_1 median_umis" class="gt_row gt_right" style="background-color: #FF2400; color: #FFFFFF;">31193</td>
<td headers="stub_1_1 median_features" class="gt_row gt_right">5014</td>
</tr>
<tr>
<th id="stub_1_2" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_2 sample" class="gt_row gt_left">Blastoid, D9; HT; 5i/L/A</td>
<td headers="stub_1_2 batch" class="gt_row gt_left">LW60</td>
<td headers="stub_1_2 num_cells" class="gt_row gt_right">4497</td>
<td headers="stub_1_2 median_umis" class="gt_row gt_right" style="background-color: #C5D100; color: #000000;">14421</td>
<td headers="stub_1_2 median_features" class="gt_row gt_right">3337</td>
</tr>
<tr>
<th id="stub_1_3" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_3 sample" class="gt_row gt_left">Blastoid, D9; HT; PXGL</td>
<td headers="stub_1_3 batch" class="gt_row gt_left">LW61</td>
<td headers="stub_1_3 num_cells" class="gt_row gt_right">5156</td>
<td headers="stub_1_3 median_umis" class="gt_row gt_right" style="background-color: #19FE00; color: #000000;">7625</td>
<td headers="stub_1_3 median_features" class="gt_row gt_right">2185</td>
</tr>
<tr>
<th id="grand_summary_stub_1" scope="row" class="gt_row gt_left gt_stub gt_grand_summary_row gt_first_grand_summary_row">Count</th>
<td headers="grand_summary_stub_1 sample" class="gt_row gt_left gt_grand_summary_row gt_first_grand_summary_row">3</td>
<td headers="grand_summary_stub_1 batch" class="gt_row gt_left gt_grand_summary_row gt_first_grand_summary_row">3</td>
<td headers="grand_summary_stub_1 num_cells" class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row">—</td>
<td headers="grand_summary_stub_1 median_umis" class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row">—</td>
<td headers="grand_summary_stub_1 median_features" class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row">—</td>
</tr>
<tr>
<th id="grand_summary_stub_2" scope="row" class="gt_row gt_left gt_stub gt_grand_summary_row">Mean</th>
<td headers="grand_summary_stub_2 sample" class="gt_row gt_left gt_grand_summary_row">—</td>
<td headers="grand_summary_stub_2 batch" class="gt_row gt_left gt_grand_summary_row">—</td>
<td headers="grand_summary_stub_2 num_cells" class="gt_row gt_right gt_grand_summary_row">—</td>
<td headers="grand_summary_stub_2 median_umis" class="gt_row gt_right gt_grand_summary_row">17,746</td>
<td headers="grand_summary_stub_2 median_features" class="gt_row gt_right gt_grand_summary_row">3,512</td>
</tr>
<tr>
<th id="grand_summary_stub_3" scope="row" class="gt_row gt_left gt_stub gt_grand_summary_row gt_last_summary_row">Sum</th>
<td headers="grand_summary_stub_3 sample" class="gt_row gt_left gt_grand_summary_row gt_last_summary_row">—</td>
<td headers="grand_summary_stub_3 batch" class="gt_row gt_left gt_grand_summary_row gt_last_summary_row">—</td>
<td headers="grand_summary_stub_3 num_cells" class="gt_row gt_right gt_grand_summary_row gt_last_summary_row">16,507</td>
<td headers="grand_summary_stub_3 median_umis" class="gt_row gt_right gt_grand_summary_row gt_last_summary_row">—</td>
<td headers="grand_summary_stub_3 median_features" class="gt_row gt_right gt_grand_summary_row gt_last_summary_row">—</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>        <span class="va">p_embedding_replicate_louvain</span>,</span>
<span>        <span class="va">p_embedding_replicate_batch</span>,</span>
<span>        <span class="va">p_embedding_replicate_UMI</span></span>
<span>    <span class="op">)</span>, <span class="va">`+`</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span></span>
<span>        theme <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display column-body-outset">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="analyze_blastoids_files/figure-html/unnamed-chunk-51-1.png" style="width:100.0%;height:100.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="cluster-composition-1" class="level3"><h3 class="anchored" data-anchor-id="cluster-composition-1">Cluster composition</h3>
<div class="cell" data-layout-align="center">

</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">calc_group_composition</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding_replicate</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"louvain"</span>,</span>
<span>    group <span class="op">=</span> <span class="st">"batch"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        louvain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">louvain</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">plot_barplot</span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="st">"louvain"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"percentage"</span>,</span>
<span>        z <span class="op">=</span> <span class="st">"batch"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="analyze_blastoids_files/figure-html/unnamed-chunk-53-1.png" style="width:50.0%;height:50.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="blastoids-derived-stem-cell-lines" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="blastoids-derived-stem-cell-lines">Blastoids derived stem cell lines</h2>
<section id="data-loading-1" class="level3"><h3 class="anchored" data-anchor-id="data-loading-1">Data loading</h3>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">EMBEDDING_FILE</span> <span class="op">&lt;-</span> <span class="st">"embedding_stem.csv.gz"</span></span>
<span></span>
<span><span class="va">embedding_stem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span></span>
<span>    file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span></span>
<span>        <span class="va">PROJECT_DIR</span>, <span class="st">"github"</span>, <span class="st">"data"</span>, <span class="va">EMBEDDING_FILE</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">EMBEDDING_FILE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MATRIX_DIR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"github/data/matrices/LW36"</span>,</span>
<span>    <span class="st">"github/data/matrices/LW49_LW50_LW51_LW52"</span>,</span>
<span>    <span class="st">"github/data/matrices/LW58_LW59"</span>,</span>
<span>    <span class="st">"github/data/matrices/LW60_LW61"</span>,</span>
<span>    <span class="st">"raw/public/PRJEB11202/reformatted_matrix"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">matrix_readcount_use</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">MATRIX_DIR</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">load_matrix</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">PROJECT_DIR</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">cbind</span><span class="op">)</span></span>
<span></span>
<span><span class="va">matrix_readcount_use</span> <span class="op">&lt;-</span> <span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">embedding_stem</span><span class="op">$</span><span class="va">cell</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="embedding-visualization-2" class="level3 page-columns page-full"><h3 class="anchored" data-anchor-id="embedding-visualization-2">Embedding visualization</h3>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">EMBEDDING_TITLE_PREFIX</span> <span class="op">&lt;-</span> <span class="st">"FIt-SNE"</span></span>
<span></span>
<span><span class="va">x_column</span> <span class="op">&lt;-</span> <span class="st">"x_fitsne"</span></span>
<span><span class="va">y_column</span> <span class="op">&lt;-</span> <span class="st">"y_fitsne"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="clustering-batch-umi-2" class="level4 page-columns page-full"><h4 class="anchored" data-anchor-id="clustering-batch-umi-2">Clustering &amp; batch &amp; UMI</h4>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p_embedding_stem_batch</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding_stem</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="va">embedding_stem</span><span class="op">$</span><span class="va">batch</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{EMBEDDING_TITLE_PREFIX}; Batch"</span><span class="op">)</span>,</span>
<span>    color_labels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    shuffle_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="va">GEOM_POINT_SIZE</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">CB_POSITION</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.875</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">p_embedding_stem_UMI</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding_stem</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html">colSums</a></span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">embedding_stem</span><span class="op">$</span><span class="va">cell</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{EMBEDDING_TITLE_PREFIX}; UMI"</span><span class="op">)</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    shuffle_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="va">GEOM_POINT_SIZE</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">CB_POSITION</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>        y <span class="op">=</span> <span class="va">CB_POSITION</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">selected_feature</span> <span class="op">&lt;-</span> <span class="st">"ENSG00000204531_POU5F1"</span></span>
<span><span class="va">p_embedding_stem_POU5F1</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding_stem</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span></span>
<span>        <span class="fu">calc_cpm</span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">embedding_stem</span><span class="op">$</span><span class="va">cell</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="op">[</span><span class="va">selected_feature</span>, <span class="op">]</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span></span>
<span>        <span class="st">"{EMBEDDING_TITLE_PREFIX}; "</span>,</span>
<span>        <span class="st">"{selected_feature |&gt; stringr::str_remove(pattern = \"^E.+_\")}"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="va">GEOM_POINT_SIZE</span>,</span>
<span>    na_value <span class="op">=</span> <span class="st">"grey80"</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">CB_POSITION</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>        y <span class="op">=</span> <span class="va">CB_POSITION</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">embedding_stem</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        num_umis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html">colSums</a></span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">cell</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        num_features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html">colSums</a></span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">cell</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">batch</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>        num_cells <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        median_umis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">num_umis</span><span class="op">)</span>,</span>
<span>        median_features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">num_features</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        sample <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">batch</span> <span class="op">==</span> <span class="st">"LW49"</span> <span class="op">~</span> <span class="st">"Naïve WIRB3; 5i/L/A"</span>,</span>
<span>            <span class="va">batch</span> <span class="op">==</span> <span class="st">"LW50"</span> <span class="op">~</span> <span class="st">"Blastoid naïve ES cells; 5i/L/A"</span>,</span>
<span>            <span class="va">batch</span> <span class="op">==</span> <span class="st">"LW51"</span> <span class="op">~</span> <span class="st">"Blastoid nEND; NACL"</span>,</span>
<span>            <span class="va">batch</span> <span class="op">==</span> <span class="st">"LW52"</span> <span class="op">~</span> <span class="st">"Blastoid TSCs; TSM"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>        <span class="va">sample</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/data_color.html">data_color</a></span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">median_umis</span><span class="op">)</span>,</span>
<span>        colors <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/col_numeric.html">col_numeric</a></span><span class="op">(</span></span>
<span>            palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                <span class="st">"green"</span>, <span class="st">"orange"</span>, <span class="st">"red"</span></span>
<span>            <span class="op">)</span>,</span>
<span>            domain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8500</span>, <span class="fl">20000</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/summary_rows.html">summary_rows</a></span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sample</span>, <span class="va">batch</span><span class="op">)</span>,</span>
<span>        fns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>            Count <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        decimals <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/summary_rows.html">summary_rows</a></span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">median_umis</span><span class="op">:</span><span class="va">median_features</span><span class="op">)</span>,</span>
<span>        fns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>            Mean <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        decimals <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/summary_rows.html">summary_rows</a></span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">num_cells</span><span class="op">)</span>,</span>
<span>        fns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>            Sum <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        decimals <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/tab_header.html">tab_header</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/md.html">md</a></span><span class="op">(</span><span class="st">"**Clustering of Blastoid Derived Cells**; Batch"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="gjvwvrvnil" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

:where(#gjvwvrvnil) .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

:where(#gjvwvrvnil) .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#gjvwvrvnil) .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

:where(#gjvwvrvnil) .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

:where(#gjvwvrvnil) .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#gjvwvrvnil) .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#gjvwvrvnil) .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

:where(#gjvwvrvnil) .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

:where(#gjvwvrvnil) .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

:where(#gjvwvrvnil) .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

:where(#gjvwvrvnil) .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

:where(#gjvwvrvnil) .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

:where(#gjvwvrvnil) .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

:where(#gjvwvrvnil) .gt_from_md > :first-child {
  margin-top: 0;
}

:where(#gjvwvrvnil) .gt_from_md > :last-child {
  margin-bottom: 0;
}

:where(#gjvwvrvnil) .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

:where(#gjvwvrvnil) .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#gjvwvrvnil) .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

:where(#gjvwvrvnil) .gt_row_group_first td {
  border-top-width: 2px;
}

:where(#gjvwvrvnil) .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#gjvwvrvnil) .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

:where(#gjvwvrvnil) .gt_first_summary_row.thick {
  border-top-width: 2px;
}

:where(#gjvwvrvnil) .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#gjvwvrvnil) .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#gjvwvrvnil) .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

:where(#gjvwvrvnil) .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

:where(#gjvwvrvnil) .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#gjvwvrvnil) .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#gjvwvrvnil) .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#gjvwvrvnil) .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#gjvwvrvnil) .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#gjvwvrvnil) .gt_left {
  text-align: left;
}

:where(#gjvwvrvnil) .gt_center {
  text-align: center;
}

:where(#gjvwvrvnil) .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

:where(#gjvwvrvnil) .gt_font_normal {
  font-weight: normal;
}

:where(#gjvwvrvnil) .gt_font_bold {
  font-weight: bold;
}

:where(#gjvwvrvnil) .gt_font_italic {
  font-style: italic;
}

:where(#gjvwvrvnil) .gt_super {
  font-size: 65%;
}

:where(#gjvwvrvnil) .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

:where(#gjvwvrvnil) .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

:where(#gjvwvrvnil) .gt_indent_1 {
  text-indent: 5px;
}

:where(#gjvwvrvnil) .gt_indent_2 {
  text-indent: 10px;
}

:where(#gjvwvrvnil) .gt_indent_3 {
  text-indent: 15px;
}

:where(#gjvwvrvnil) .gt_indent_4 {
  text-indent: 20px;
}

:where(#gjvwvrvnil) .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
<thead class="gt_header"><tr>
<td colspan="6" class="gt_heading gt_title gt_font_normal gt_bottom_border" style="">
<strong>Clustering of Blastoid Derived Cells</strong>; Batch</td>
    </tr></thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=""></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="sample">sample</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="batch">batch</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="num_cells">num_cells</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="median_umis">median_umis</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="median_features">median_features</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<th id="stub_1_1" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_1 sample" class="gt_row gt_left">Naïve WIRB3; 5i/L/A</td>
<td headers="stub_1_1 batch" class="gt_row gt_left">LW49</td>
<td headers="stub_1_1 num_cells" class="gt_row gt_right">1638</td>
<td headers="stub_1_1 median_umis" class="gt_row gt_right" style="background-color: #FF5100; color: #FFFFFF;">18363.0</td>
<td headers="stub_1_1 median_features" class="gt_row gt_right">4025.5</td>
</tr>
<tr>
<th id="stub_1_2" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_2 sample" class="gt_row gt_left">Blastoid naïve ES cells; 5i/L/A</td>
<td headers="stub_1_2 batch" class="gt_row gt_left">LW50</td>
<td headers="stub_1_2 num_cells" class="gt_row gt_right">2663</td>
<td headers="stub_1_2 median_umis" class="gt_row gt_right" style="background-color: #54F800; color: #000000;">9022.0</td>
<td headers="stub_1_2 median_features" class="gt_row gt_right">2734.0</td>
</tr>
<tr>
<th id="stub_1_3" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_3 sample" class="gt_row gt_left">Blastoid nEND; NACL</td>
<td headers="stub_1_3 batch" class="gt_row gt_left">LW51</td>
<td headers="stub_1_3 num_cells" class="gt_row gt_right">2055</td>
<td headers="stub_1_3 median_umis" class="gt_row gt_right" style="background-color: #C5D100; color: #000000;">11767.0</td>
<td headers="stub_1_3 median_features" class="gt_row gt_right">3250.0</td>
</tr>
<tr>
<th id="stub_1_4" scope="row" class="gt_row gt_left gt_stub"></th>
<td headers="stub_1_4 sample" class="gt_row gt_left">Blastoid TSCs; TSM</td>
<td headers="stub_1_4 batch" class="gt_row gt_left">LW52</td>
<td headers="stub_1_4 num_cells" class="gt_row gt_right">4486</td>
<td headers="stub_1_4 median_umis" class="gt_row gt_right" style="background-color: #20FE00; color: #000000;">8585.5</td>
<td headers="stub_1_4 median_features" class="gt_row gt_right">2581.0</td>
</tr>
<tr>
<th id="grand_summary_stub_1" scope="row" class="gt_row gt_left gt_stub gt_grand_summary_row gt_first_grand_summary_row">Count</th>
<td headers="grand_summary_stub_1 sample" class="gt_row gt_left gt_grand_summary_row gt_first_grand_summary_row">4</td>
<td headers="grand_summary_stub_1 batch" class="gt_row gt_left gt_grand_summary_row gt_first_grand_summary_row">4</td>
<td headers="grand_summary_stub_1 num_cells" class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row">—</td>
<td headers="grand_summary_stub_1 median_umis" class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row">—</td>
<td headers="grand_summary_stub_1 median_features" class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row">—</td>
</tr>
<tr>
<th id="grand_summary_stub_2" scope="row" class="gt_row gt_left gt_stub gt_grand_summary_row">Mean</th>
<td headers="grand_summary_stub_2 sample" class="gt_row gt_left gt_grand_summary_row">—</td>
<td headers="grand_summary_stub_2 batch" class="gt_row gt_left gt_grand_summary_row">—</td>
<td headers="grand_summary_stub_2 num_cells" class="gt_row gt_right gt_grand_summary_row">—</td>
<td headers="grand_summary_stub_2 median_umis" class="gt_row gt_right gt_grand_summary_row">11,934</td>
<td headers="grand_summary_stub_2 median_features" class="gt_row gt_right gt_grand_summary_row">3,148</td>
</tr>
<tr>
<th id="grand_summary_stub_3" scope="row" class="gt_row gt_left gt_stub gt_grand_summary_row gt_last_summary_row">Sum</th>
<td headers="grand_summary_stub_3 sample" class="gt_row gt_left gt_grand_summary_row gt_last_summary_row">—</td>
<td headers="grand_summary_stub_3 batch" class="gt_row gt_left gt_grand_summary_row gt_last_summary_row">—</td>
<td headers="grand_summary_stub_3 num_cells" class="gt_row gt_right gt_grand_summary_row gt_last_summary_row">10,842</td>
<td headers="grand_summary_stub_3 median_umis" class="gt_row gt_right gt_grand_summary_row gt_last_summary_row">—</td>
<td headers="grand_summary_stub_3 median_features" class="gt_row gt_right gt_grand_summary_row gt_last_summary_row">—</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    <span class="va">p_embedding_stem_batch</span>,</span>
<span>    <span class="va">p_embedding_stem_UMI</span>,</span>
<span>    <span class="va">p_embedding_stem_POU5F1</span></span>
<span><span class="op">)</span>, <span class="va">`+`</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span></span>
<span>        theme <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display column-body-outset">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="analyze_blastoids_files/figure-html/unnamed-chunk-59-1.png" style="width:100.0%;height:100.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section><section id="polishing-1" class="level4"><h4 class="anchored" data-anchor-id="polishing-1">Polishing</h4>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p_embedding_stem_batch</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding_stem</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="va">embedding_stem</span><span class="op">$</span><span class="va">batch</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    color_labels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    shuffle_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="va">GEOM_POINT_SIZE</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span>void <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span></span>
<span>        values <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/hue_pal.html">hue_pal</a></span><span class="op">(</span><span class="op">)</span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">embedding_stem</span><span class="op">$</span><span class="va">batch</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>            <span class="st">"Naïve ES cells"</span>,</span>
<span>            <span class="st">"Blastoid Naïve ES cells"</span>,</span>
<span>            <span class="st">"Blastoid nEND"</span>,</span>
<span>            <span class="st">"Blastoid TSCs"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot_build.html">ggplot_build</a></span><span class="op">(</span></span>
<span>    <span class="va">p_embedding_stem_batch</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">layout</span><span class="op">$</span><span class="va">panel_params</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x.range"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">y_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot_build.html">ggplot_build</a></span><span class="op">(</span></span>
<span>    <span class="va">p_embedding_stem_batch</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">layout</span><span class="op">$</span><span class="va">panel_params</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"y.range"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="va">features_selected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"ENSG00000181449_SOX2"</span>,</span>
<span>    <span class="st">"ENSG00000141448_GATA6"</span>,</span>
<span>    <span class="st">"ENSG00000107485_GATA3"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_embedding_stem_SOX2_GATA6_GATA3</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">features_selected</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">selected_feature</span> <span class="op">&lt;-</span> <span class="va">x</span></span>
<span></span>
<span>    <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">embedding_stem</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>        color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span></span>
<span>            <span class="fu">calc_cpm</span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">embedding_stem</span><span class="op">$</span><span class="va">cell</span><span class="op">]</span><span class="op">)</span></span>
<span>            <span class="op">[</span><span class="va">selected_feature</span>, <span class="op">]</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>        <span class="op">)</span>,</span>
<span>        label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        sort_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>        geom_point_size <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>        na_value <span class="op">=</span> <span class="st">"grey80"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">theme_customized_embedding</span><span class="op">(</span></span>
<span>            x <span class="op">=</span> <span class="va">CB_POSITION</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>            y <span class="op">=</span> <span class="va">CB_POSITION</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>            void <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            legend_key_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span></span>
<span>            geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>            x <span class="op">=</span> <span class="va">x_label</span>,</span>
<span>            y <span class="op">=</span> <span class="va">y_label</span>,</span>
<span>            label <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span></span>
<span>                <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"^E.+_"</span><span class="op">)</span></span>
<span>            <span class="op">)</span>,</span>
<span>            family <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>            color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">5</span> <span class="op">/</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/graphical-units.html">.pt</a></span>,</span>
<span>            hjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>            vjust <span class="op">=</span> <span class="fl">0</span></span>
<span>            <span class="co"># parse = TRUE</span></span>
<span>        <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    <span class="va">p_embedding_stem_batch</span>,</span>
<span>    <span class="va">p_embedding_stem_SOX2_GATA6_GATA3</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">`+`</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span></span>
<span>        theme <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="analyze_blastoids_files/figure-html/unnamed-chunk-62-1.png" style="width:80.0%;height:80.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section></section></section><section id="trajectory-inference" class="level2"><h2 class="anchored" data-anchor-id="trajectory-inference">Trajectory inference</h2>
<div class="cell">

</div>
<section id="data-loading-2" class="level3"><h3 class="anchored" data-anchor-id="data-loading-2">Data loading</h3>
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">EMBEDDING_FILE</span> <span class="op">&lt;-</span> <span class="st">"embedding_timecourse.csv.gz"</span></span>
<span></span>
<span><span class="va">embedding_timecourse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span></span>
<span>    file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">PROJECT_DIR</span>, <span class="st">"github"</span>, <span class="st">"data"</span>, <span class="va">EMBEDDING_FILE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">EMBEDDING_FILE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MATRIX_DIR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"github/data/matrices/LW36"</span>,</span>
<span>    <span class="st">"github/data/matrices/LW49_LW50_LW51_LW52"</span>,</span>
<span>    <span class="st">"github/data/matrices/LW58_LW59"</span>,</span>
<span>    <span class="st">"github/data/matrices/LW60_LW61"</span>,</span>
<span>    <span class="st">"raw/public/PRJEB11202/reformatted_matrix"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">matrix_readcount_use</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">MATRIX_DIR</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">load_matrix</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">PROJECT_DIR</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">cbind</span><span class="op">)</span></span>
<span></span>
<span><span class="va">matrix_readcount_use</span> <span class="op">&lt;-</span> <span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">embedding_timecourse</span><span class="op">$</span><span class="va">cell</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># clean up</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">MATRIX_DIR</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="embedding-visualization-3" class="level3"><h3 class="anchored" data-anchor-id="embedding-visualization-3">Embedding visualization</h3>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">EMBEDDING_TITLE_PREFIX</span> <span class="op">&lt;-</span> <span class="st">"FIt-SNE"</span></span>
<span></span>
<span><span class="va">x_column</span> <span class="op">&lt;-</span> <span class="st">"x_fitsne"</span></span>
<span><span class="va">y_column</span> <span class="op">&lt;-</span> <span class="st">"y_fitsne"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="clustering-batch-umi-3" class="level4"><h4 class="anchored" data-anchor-id="clustering-batch-umi-3">Clustering &amp; batch &amp; UMI</h4>
<div class="cell">
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p_embedding_timecourse_cluster</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding_timecourse</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">embedding_timecourse</span><span class="op">$</span><span class="va">louvain</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{EMBEDDING_TITLE_PREFIX}; Cluster"</span><span class="op">)</span>,</span>
<span>    color_labels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    shuffle_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="va">GEOM_POINT_SIZE</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_embedding_timecourse_batch</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding_timecourse</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="va">embedding_timecourse</span><span class="op">$</span><span class="va">batch</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{EMBEDDING_TITLE_PREFIX}; Batch"</span><span class="op">)</span>,</span>
<span>    color_labels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    shuffle_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="va">GEOM_POINT_SIZE</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">CB_POSITION</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.875</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">p_embedding_timecourse_UMI</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding_timecourse</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span></span>
<span>        <span class="fu">Matrix</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html">colSums</a></span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">embedding_timecourse</span><span class="op">$</span><span class="va">cell</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"{EMBEDDING_TITLE_PREFIX}; UMI"</span><span class="op">)</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    shuffle_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="va">GEOM_POINT_SIZE</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">CB_POSITION</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>        y <span class="op">=</span> <span class="va">CB_POSITION</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">selected_feature</span> <span class="op">&lt;-</span> <span class="st">"ENSG00000204531_POU5F1"</span></span>
<span><span class="va">p_embedding_timecourse_POU5F1</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding_timecourse</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span></span>
<span>        <span class="fu">calc_cpm</span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">embedding_timecourse</span><span class="op">$</span><span class="va">cell</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="op">[</span><span class="va">selected_feature</span>, <span class="op">]</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span></span>
<span>        <span class="st">"{EMBEDDING_TITLE_PREFIX}; "</span>,</span>
<span>        <span class="st">"{selected_feature |&gt; stringr::str_remove(pattern = \"^E.+_\")}"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="va">GEOM_POINT_SIZE</span>,</span>
<span>    na_value <span class="op">=</span> <span class="st">"grey80"</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">CB_POSITION</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>        y <span class="op">=</span> <span class="va">CB_POSITION</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    <span class="va">p_embedding_timecourse_cluster</span>,</span>
<span>    <span class="va">p_embedding_timecourse_batch</span>,</span>
<span>    <span class="va">p_embedding_timecourse_UMI</span>,</span>
<span>    <span class="va">p_embedding_timecourse_POU5F1</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">`+`</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span></span>
<span>        theme <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="analyze_blastoids_files/figure-html/unnamed-chunk-68-1.png" style="width:80.0%;height:80.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section><section id="polishing-2" class="level4"><h4 class="anchored" data-anchor-id="polishing-2">Polishing</h4>
<div class="cell">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p_embedding_timecourse_batch</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding_timecourse</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="va">embedding_timecourse</span><span class="op">$</span><span class="va">batch</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    color_labels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    shuffle_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="va">GEOM_POINT_SIZE</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span>void <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span></span>
<span>        values <span class="op">=</span> <span class="fu">yarrr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yarrr/man/piratepal.html">piratepal</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"google"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"D3"</span>, <span class="st">"D6"</span>, <span class="st">"D9"</span>, <span class="st">"D9; PXGL"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">embedding_timecourse</span> <span class="op">&lt;-</span> <span class="va">embedding_timecourse</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">cell</span><span class="op">:</span><span class="va">y_fitsne</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span></span>
<span>        <span class="va">embedding</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">cell</span>, louvain_ <span class="op">=</span> <span class="va">louvain</span><span class="op">)</span>,</span>
<span>        by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cell"</span> <span class="op">=</span> <span class="st">"cell"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        louvain_ <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">louvain_</span><span class="op">)</span> <span class="op">~</span> <span class="st">"NA"</span>,</span>
<span>            <span class="cn">TRUE</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">louvain_</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="co">#</span></span>
<span>        lineage <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">louvain_</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">11</span><span class="op">)</span> <span class="op">~</span> <span class="st">"EPI"</span>,</span>
<span>            <span class="va">louvain_</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">18</span><span class="op">)</span> <span class="op">~</span> <span class="st">"HYP"</span>,</span>
<span>            <span class="va">louvain_</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">12</span>, <span class="fl">17</span><span class="op">)</span> <span class="op">~</span> <span class="st">"TE"</span>,</span>
<span>            <span class="va">louvain_</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">14</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Pre-lineage"</span>,</span>
<span>            <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"Other"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        lineage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>            <span class="va">lineage</span>,</span>
<span>            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"TE"</span>, <span class="st">"Pre-lineage"</span>, <span class="st">"HYP"</span>, <span class="st">"EPI"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="co">#</span></span>
<span>        cluters_selected <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>            <span class="va">louvain_</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">13</span>, <span class="fl">15</span>, <span class="fl">16</span><span class="op">)</span> <span class="op">~</span> <span class="va">louvain_</span>,</span>
<span>            <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"Other"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        cluters_selected <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>            <span class="va">cluters_selected</span>,</span>
<span>            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                <span class="st">"Other"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span>, <span class="st">"6"</span>, <span class="st">"7"</span>, <span class="st">"13"</span>, <span class="st">"15"</span>, <span class="st">"16"</span></span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p_embedding_timecourse_lineage</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding_timecourse</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="va">embedding_timecourse</span><span class="op">$</span><span class="va">lineage</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    color_labels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    shuffle_values <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="va">GEOM_POINT_SIZE</span>,</span>
<span>    na_value <span class="op">=</span> <span class="st">"grey70"</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span></span>
<span>        name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TE"</span>, <span class="st">"Pre-lineage"</span>, <span class="st">"HYP"</span>, <span class="st">"EPI"</span><span class="op">)</span>,</span>
<span>        values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"grey70"</span>, <span class="st">"#8ace7e"</span>, <span class="st">"#ff684c"</span>, <span class="st">"#9467bd"</span>, <span class="st">"#ffd8b1"</span><span class="op">)</span>,</span>
<span>        breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"EPI"</span>, <span class="st">"HYP"</span>, <span class="st">"TE"</span>, <span class="st">"Pre-lineage"</span><span class="op">)</span>,</span>
<span>        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"ELCs"</span>, <span class="st">"HLCs"</span>, <span class="st">"TLCs"</span>, <span class="st">"Pre-lineage-like"</span><span class="op">)</span>,</span>
<span>        guide <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span></span>
<span>            color <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span></span>
<span>                override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>                    size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">1</span></span>
<span>                <span class="op">)</span>,</span>
<span>                ncol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                reverse <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                order <span class="op">=</span> <span class="fl">1</span></span>
<span>            <span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        na.value <span class="op">=</span> <span class="st">"grey70"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span>void <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p_embedding_timecourse_cluster</span> <span class="op">&lt;-</span> <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding_timecourse</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    color <span class="op">=</span> <span class="va">embedding_timecourse</span><span class="op">$</span><span class="va">cluters_selected</span>,</span>
<span>    label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    color_labels <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sort_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    shuffle_values <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>    geom_point_size <span class="op">=</span> <span class="va">GEOM_POINT_SIZE</span>,</span>
<span>    geom_point_legend_ncol <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span></span>
<span>        values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span> <span class="op">=</span> <span class="st">"grey70"</span>, <span class="va">color_palette_cluster</span><span class="op">)</span>,</span>
<span>        limits <span class="op">=</span> <span class="va">embedding_timecourse</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cluters_selected</span> <span class="op">!=</span> <span class="st">"Other"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">cluters_selected</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>            <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_order.html">str_sort</a></span><span class="op">(</span>numeric <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        na.value <span class="op">=</span> <span class="st">"grey70"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_customized_embedding</span><span class="op">(</span>void <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="fu">get_middle_points</span><span class="op">(</span></span>
<span>            data <span class="op">=</span> <span class="va">embedding_timecourse</span> <span class="op">|&gt;</span></span>
<span>                <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cluters_selected</span> <span class="op">!=</span> <span class="st">"Other"</span><span class="op">)</span>,</span>
<span>            x <span class="op">=</span> <span class="va">x_column</span>,</span>
<span>            y <span class="op">=</span> <span class="va">y_column</span>,</span>
<span>            group <span class="op">=</span> <span class="st">"cluters_selected"</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>            x <span class="op">=</span> <span class="va">x_fitsne</span>,</span>
<span>            y <span class="op">=</span> <span class="va">y_fitsne</span>,</span>
<span>            label <span class="op">=</span> <span class="va">cluters_selected</span></span>
<span>        <span class="op">)</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        size <span class="op">=</span> <span class="fl">1.8</span>,</span>
<span>        family <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>        <span class="co">#</span></span>
<span>        box.padding <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>        point.padding <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>        min.segment.length <span class="op">=</span> <span class="fl">0</span>,</span>
<span>        arrow <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.015</span>, <span class="st">"npc"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        max.overlaps <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>        nudge_x <span class="op">=</span> <span class="fl">0</span>,</span>
<span>        nudge_y <span class="op">=</span> <span class="fl">10</span>,</span>
<span>        <span class="co">#</span></span>
<span>        segment.color <span class="op">=</span> <span class="st">"grey35"</span>,</span>
<span>        segment.size <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>        segment.alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        <span class="co"># segment.inflect = TRUE,</span></span>
<span>        seed <span class="op">=</span> <span class="fl">20201121</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">

</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">features_selected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"ENSG00000181449_SOX2"</span>,</span>
<span>    <span class="st">"ENSG00000141448_GATA6"</span>,</span>
<span>    <span class="st">"ENSG00000107485_GATA3"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_embedding_timecourse_SOX2_GATA6_GATA3</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">features_selected</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">selected_feature</span> <span class="op">&lt;-</span> <span class="va">x</span></span>
<span></span>
<span>    <span class="fu">plot_embedding</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">embedding_timecourse</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">x_column</span>, <span class="va">y_column</span><span class="op">)</span><span class="op">]</span>,</span>
<span>        color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span></span>
<span>            <span class="fu">calc_cpm</span><span class="op">(</span><span class="va">matrix_readcount_use</span><span class="op">[</span>, <span class="va">embedding_timecourse</span><span class="op">$</span><span class="va">cell</span><span class="op">]</span><span class="op">)</span></span>
<span>            <span class="op">[</span><span class="va">selected_feature</span>, <span class="op">]</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>        <span class="op">)</span>,</span>
<span>        label <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        color_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        sort_values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        rasterise <span class="op">=</span> <span class="va">RASTERISED</span>,</span>
<span>        geom_point_size <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>        na_value <span class="op">=</span> <span class="st">"grey80"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">theme_customized_embedding</span><span class="op">(</span></span>
<span>            x <span class="op">=</span> <span class="va">CB_POSITION</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>            y <span class="op">=</span> <span class="va">CB_POSITION</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>            void <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            legend_key_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span></span>
<span>            geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>            x <span class="op">=</span> <span class="va">x_label</span>,</span>
<span>            y <span class="op">=</span> <span class="va">y_label</span>,</span>
<span>            label <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html">str_c</a></span><span class="op">(</span></span>
<span>                <span class="va">x</span> <span class="op">|&gt;</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"^E.+_"</span><span class="op">)</span></span>
<span>            <span class="op">)</span>,</span>
<span>            family <span class="op">=</span> <span class="st">"Arial"</span>,</span>
<span>            color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>            size <span class="op">=</span> <span class="fl">5</span> <span class="op">/</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/graphical-units.html">.pt</a></span>,</span>
<span>            hjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>            vjust <span class="op">=</span> <span class="fl">0</span></span>
<span>            <span class="co"># parse = TRUE</span></span>
<span>        <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>        <span class="va">p_embedding_timecourse_batch</span>,</span>
<span>        <span class="va">p_embedding_timecourse_lineage</span>,</span>
<span>        <span class="va">p_embedding_timecourse_cluster</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="va">p_embedding_timecourse_SOX2_GATA6_GATA3</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span><span class="op">(</span><span class="va">`+`</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span></span>
<span>        theme <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="analyze_blastoids_files/figure-html/unnamed-chunk-75-1.png" style="width:90.0%;height:90.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="cluster-composition-2" class="level3"><h3 class="anchored" data-anchor-id="cluster-composition-2">Cluster composition</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">calc_group_composition</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">embedding_timecourse</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"louvain"</span>,</span>
<span>    group <span class="op">=</span> <span class="st">"batch"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>        louvain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">louvain</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">plot_barplot</span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="st">"louvain"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"percentage"</span>,</span>
<span>        z <span class="op">=</span> <span class="st">"batch"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span></span>
<span>        values <span class="op">=</span> <span class="fu">yarrr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yarrr/man/piratepal.html">piratepal</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"google"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"D3"</span>, <span class="st">"D6"</span>, <span class="st">"D9"</span>, <span class="st">"D9; PXGL"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="analyze_blastoids_files/figure-html/unnamed-chunk-76-1.png" style="width:50.0%;height:50.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section></section><section id="r-session-info" class="level2"><h2 class="anchored" data-anchor-id="r-session-info">R session info</h2>
<div class="cell">
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://r-lib.github.io/sessioninfo/reference/session_info.html">session_info</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.2.1 (2022-06-23)
 os       macOS Monterey 12.6
 system   aarch64, darwin21.6.0
 ui       unknown
 language (EN)
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       America/Chicago
 date     2022-09-24
 pandoc   2.19.2 @ /opt/homebrew/bin/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 package        * version       date (UTC) lib source
 BayesFactor      0.9.12-4.4    2022-07-05 [1] CRAN (R 4.2.1)
 BiocGenerics     0.42.0        2022-04-26 [1] Bioconductor
 bit              4.0.4         2020-08-04 [1] CRAN (R 4.2.0)
 bit64            4.0.5         2020-08-30 [1] CRAN (R 4.2.0)
 cachem           1.0.6         2021-08-19 [1] CRAN (R 4.2.0)
 Cairo            1.6-0         2022-07-05 [1] CRAN (R 4.2.1)
 callr            3.7.2         2022-08-22 [1] CRAN (R 4.2.1)
 circlize         0.4.15        2022-05-10 [1] CRAN (R 4.2.0)
 cli              3.4.1         2022-09-23 [1] CRAN (R 4.2.1)
 clue             0.3-61        2022-05-30 [1] CRAN (R 4.2.0)
 cluster          2.1.4         2022-08-22 [2] CRAN (R 4.2.1)
 coda             0.19-4        2020-09-30 [1] CRAN (R 4.2.0)
 codetools        0.2-18        2020-11-04 [2] CRAN (R 4.2.1)
 colorspace       2.0-3         2022-02-21 [1] CRAN (R 4.2.0)
 commonmark       1.8.0         2022-03-09 [1] CRAN (R 4.2.0)
 ComplexHeatmap   2.12.1        2022-08-09 [1] Bioconductor
 crayon           1.5.1         2022-03-26 [1] CRAN (R 4.2.0)
 devtools         2.4.4.9000    2022-09-23 [1] Github (r-lib/devtools@9e2793a)
 digest           0.6.29        2021-12-01 [1] CRAN (R 4.2.0)
 doParallel       1.0.17        2022-02-07 [1] CRAN (R 4.2.0)
 dplyr          * 1.0.99.9000   2022-09-23 [1] Github (tidyverse/dplyr@19c2be3)
 ellipsis         0.3.2         2021-04-29 [1] CRAN (R 4.2.0)
 evaluate         0.16          2022-08-09 [1] CRAN (R 4.2.1)
 extrafont      * 0.18          2022-04-12 [1] CRAN (R 4.2.0)
 extrafontdb      1.0           2012-06-11 [1] CRAN (R 4.2.0)
 fansi            1.0.3         2022-03-24 [1] CRAN (R 4.2.0)
 farver           2.1.1         2022-07-06 [1] CRAN (R 4.2.1)
 fastmap          1.1.0         2021-01-25 [1] CRAN (R 4.2.0)
 forcats        * 0.5.2.9000    2022-08-20 [1] Github (tidyverse/forcats@bd319e0)
 foreach          1.5.2         2022-02-02 [1] CRAN (R 4.2.0)
 fs               1.5.2.9000    2022-08-24 [1] Github (r-lib/fs@238032f)
 generics         0.1.3         2022-07-05 [1] CRAN (R 4.2.1)
 GetoptLong       1.0.5         2020-12-15 [1] CRAN (R 4.2.0)
 ggplot2        * 3.3.6.9000    2022-09-12 [1] Github (tidyverse/ggplot2@a58b48c)
 ggrepel          0.9.1         2021-01-15 [1] CRAN (R 4.2.0)
 ggthemes         4.2.4         2021-01-20 [1] CRAN (R 4.2.0)
 GlobalOptions    0.1.2         2020-06-10 [1] CRAN (R 4.2.0)
 glue             1.6.2.9000    2022-04-22 [1] Github (tidyverse/glue@d47d6c7)
 gridExtra        2.3           2017-09-09 [1] CRAN (R 4.2.0)
 gt               0.7.0.9000    2022-09-23 [1] Github (rstudio/gt@4030fb7)
 gtable           0.3.1.9000    2022-09-01 [1] Github (r-lib/gtable@c1a7a81)
 hms              1.1.2         2022-08-19 [1] CRAN (R 4.2.1)
 htmltools        0.5.3         2022-07-18 [1] CRAN (R 4.2.1)
 htmlwidgets      1.5.4         2022-08-23 [1] Github (ramnathv/htmlwidgets@400cf1a)
 httpuv           1.6.6         2022-09-08 [1] CRAN (R 4.2.1)
 IRanges          2.30.1        2022-08-18 [1] Bioconductor
 iterators        1.0.14        2022-02-05 [1] CRAN (R 4.2.0)
 jpeg             0.1-9         2021-07-24 [1] CRAN (R 4.2.0)
 jsonlite         1.8.0         2022-02-22 [1] CRAN (R 4.2.0)
 knitr            1.40          2022-08-24 [1] CRAN (R 4.2.1)
 labeling         0.4.2         2020-10-20 [1] CRAN (R 4.2.0)
 later            1.3.0         2021-08-18 [1] CRAN (R 4.2.0)
 lattice          0.20-45       2021-09-22 [2] CRAN (R 4.2.1)
 lifecycle        1.0.2.9000    2022-09-23 [1] Github (r-lib/lifecycle@0a6860a)
 lubridate      * 1.8.0.9000    2022-05-24 [1] Github (tidyverse/lubridate@0bb49b2)
 magick           2.7.3         2021-08-18 [1] CRAN (R 4.2.0)
 magrittr         2.0.3         2022-03-30 [1] CRAN (R 4.2.0)
 Matrix         * 1.5-1         2022-09-13 [1] CRAN (R 4.2.1)
 MatrixModels     0.5-1         2022-09-11 [1] CRAN (R 4.2.1)
 matrixStats      0.62.0        2022-04-19 [1] CRAN (R 4.2.0)
 memoise          2.0.1         2021-11-26 [1] CRAN (R 4.2.0)
 mime             0.12          2021-09-28 [1] CRAN (R 4.2.0)
 miniUI           0.1.1.1       2018-05-18 [1] CRAN (R 4.2.0)
 munsell          0.5.0         2018-06-12 [1] CRAN (R 4.2.0)
 mvtnorm          1.1-3         2021-10-08 [1] CRAN (R 4.2.1)
 patchwork      * 1.1.2.9000    2022-08-20 [1] Github (thomasp85/patchwork@c14c960)
 pbapply          1.5-0         2021-09-16 [1] CRAN (R 4.2.0)
 pillar           1.8.1         2022-08-19 [1] CRAN (R 4.2.1)
 pkgbuild         1.3.1         2021-12-20 [1] CRAN (R 4.2.0)
 pkgconfig        2.0.3         2019-09-22 [1] CRAN (R 4.2.0)
 pkgload          1.3.0         2022-06-27 [1] CRAN (R 4.2.1)
 png              0.1-7         2013-12-03 [1] CRAN (R 4.2.0)
 prettyunits      1.1.1.9000    2022-04-22 [1] Github (r-lib/prettyunits@8706d89)
 processx         3.7.0         2022-07-07 [1] CRAN (R 4.2.1)
 profvis          0.3.7         2020-11-02 [1] CRAN (R 4.2.0)
 promises         1.2.0.1       2021-02-11 [1] CRAN (R 4.2.0)
 ps               1.7.1         2022-06-18 [1] CRAN (R 4.2.0)
 purrr          * 0.9000.0.9000 2022-09-24 [1] Github (tidyverse/purrr@4ab13f5)
 R.cache          0.16.0        2022-07-21 [1] CRAN (R 4.2.1)
 R.methodsS3      1.8.2         2022-06-13 [1] CRAN (R 4.2.0)
 R.oo             1.25.0        2022-06-12 [1] CRAN (R 4.2.0)
 R.utils          2.12.0        2022-06-28 [1] CRAN (R 4.2.1)
 R6               2.5.1.9000    2022-08-04 [1] Github (r-lib/R6@87d5e45)
 ragg             1.2.2.9000    2022-09-12 [1] Github (r-lib/ragg@904e145)
 RColorBrewer     1.1-3         2022-04-03 [1] CRAN (R 4.2.0)
 Rcpp             1.0.9         2022-07-08 [1] CRAN (R 4.2.1)
 readr          * 2.1.2.9000    2022-09-20 [1] Github (tidyverse/readr@5cac6ed)
 remotes          2.4.2         2022-09-12 [1] Github (r-lib/remotes@bc0949d)
 reticulate       1.26          2022-08-31 [1] CRAN (R 4.2.1)
 rjson            0.2.21        2022-01-09 [1] CRAN (R 4.2.0)
 rlang            1.0.6         2022-09-24 [1] Github (r-lib/rlang@66454bd)
 rmarkdown        2.16.1        2022-09-24 [1] Github (rstudio/rmarkdown@9577707)
 Rttf2pt1         1.3.10        2022-02-07 [1] CRAN (R 4.2.0)
 S4Vectors        0.34.0        2022-04-26 [1] Bioconductor
 sass             0.4.2         2022-07-16 [1] CRAN (R 4.2.1)
 scales           1.2.1.9000    2022-08-20 [1] Github (r-lib/scales@b3df2fb)
 sessioninfo      1.2.2         2021-12-06 [1] CRAN (R 4.2.0)
 shape            1.4.6         2021-05-19 [1] CRAN (R 4.2.0)
 shiny            1.7.2         2022-07-19 [1] CRAN (R 4.2.1)
 stringi          1.7.8         2022-07-11 [1] CRAN (R 4.2.1)
 stringr        * 1.4.1.9000    2022-08-21 [1] Github (tidyverse/stringr@792bc92)
 styler         * 1.7.0.9002    2022-09-21 [1] Github (r-lib/styler@1f4437b)
 systemfonts      1.0.4         2022-02-11 [1] CRAN (R 4.2.0)
 textshaping      0.3.6         2021-10-13 [1] CRAN (R 4.2.0)
 tibble         * 3.1.8.9002    2022-09-24 [1] Github (tidyverse/tibble@e9db4f4)
 tidyr          * 1.2.1.9000    2022-09-09 [1] Github (tidyverse/tidyr@653def2)
 tidyselect       1.1.2.9000    2022-09-21 [1] Github (r-lib/tidyselect@edd0a3b)
 tidyverse      * 1.3.2.9000    2022-09-12 [1] Github (tidyverse/tidyverse@3be8283)
 tzdb             0.3.0         2022-03-28 [1] CRAN (R 4.2.0)
 urlchecker       1.0.1         2021-11-30 [1] CRAN (R 4.2.0)
 usethis          2.1.6.9000    2022-09-23 [1] Github (r-lib/usethis@8ecb7ab)
 utf8             1.2.2         2021-07-24 [1] CRAN (R 4.2.0)
 vctrs            0.4.1.9000    2022-09-19 [1] Github (r-lib/vctrs@0a219ba)
 viridis          0.6.2         2021-10-13 [1] CRAN (R 4.2.0)
 viridisLite      0.4.1         2022-08-22 [1] CRAN (R 4.2.1)
 vroom            1.5.7.9000    2022-09-09 [1] Github (r-lib/vroom@0c2423e)
 withr            2.5.0         2022-03-03 [1] CRAN (R 4.2.0)
 xfun             0.33          2022-09-12 [1] CRAN (R 4.2.1)
 xtable           1.8-4         2019-04-21 [1] CRAN (R 4.2.0)
 yaml             2.3.5         2022-02-21 [1] CRAN (R 4.2.0)
 yarrr            0.1.6         2022-04-22 [1] Github (ndphillips/yarrr@e2e4488)

 [1] /opt/homebrew/lib/R/4.2/site-library
 [2] /opt/homebrew/Cellar/r/4.2.1_4/lib/R/library

─ Python configuration ───────────────────────────────────────────────────────
 python:         /Users/jialei/.pyenv/shims/python
 libpython:      /Users/jialei/.pyenv/versions/mambaforge-4.10.3-10/lib/libpython3.9.dylib
 pythonhome:     /Users/jialei/.pyenv/versions/mambaforge-4.10.3-10:/Users/jialei/.pyenv/versions/mambaforge-4.10.3-10
 version:        3.9.13 | packaged by conda-forge | (main, May 27 2022, 17:00:33)  [Clang 13.0.1 ]
 numpy:          /Users/jialei/.pyenv/versions/mambaforge-4.10.3-10/lib/python3.9/site-packages/numpy
 numpy_version:  1.22.4
 numpy:          /Users/jialei/.pyenv/versions/mambaforge-4.10.3-10/lib/python3.9/site-packages/numpy
 
 NOTE: Python version was forced by RETICULATE_PYTHON

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
<p><br><br></p>


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@article{yu,
  author = {Leqian Yu and Yulei Wei and Jialei Duan and Daniel A.
    Schmitz and Masahiro Sakurai and Lei Wang and Kunhua Wang and Shuhua
    Zhao and Gary C. Hon and Jun Wu},
  editor = {},
  publisher = {Nature Publishing Group},
  title = {Blastocyst-Like Structures Generated from Human Pluripotent
    Stem Cells},
  journal = {Nature},
  volume = {591},
  number = {7851},
  pages = {620 - 626},
  date = {},
  url = {https://doi.org/10.1038/s41586-021-03356-y},
  doi = {10.1038/s41586-021-03356-y},
  langid = {en},
  abstract = {Human blastoids provide a readily accessible, scalable,
    versatile and perturbable alternative to blastocysts for studying
    early human development, understanding early pregnancy loss and
    gaining insights into early developmental defects.}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-yu" class="csl-entry quarto-appendix-citeas" role="doc-biblioentry">
Leqian Yu, Yulei Wei, Jialei Duan, Daniel A. Schmitz, Masahiro Sakurai,
Lei Wang, Kunhua Wang, Shuhua Zhao, Gary C. Hon, and Jun Wu. n.d.
<span>“Blastocyst-Like Structures Generated from Human Pluripotent Stem
Cells.”</span> <em>Nature</em> 591 (7851): 620–26. <a href="https://doi.org/10.1038/s41586-021-03356-y">https://doi.org/10.1038/s41586-021-03356-y</a>.
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp(/^(?:http:|https:)\/\/leafletjs\.com/);
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./cluster_blastoids.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Cluster</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./compare_blastoids.html" class="pagination-link">
        <span class="nav-page-text">Compare</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">Copyright © 2022, Jialei Duan</div>   
      <div class="nav-footer-center">
        <ul class="footer-items list-unstyled">
<li class="nav-item">
    <a class="nav-link" href="https://github.com/jlduan/Human_blastoid/blob/master/LICENSE"><i class="fa-solid fa-file-lines" aria-hidden="true"></i> License</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="./about.html"><i class="fa-solid fa-circle-info" aria-hidden="true"></i> About</a>
  </li>  
</ul>
</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link active" href="https://twitter.com/jlduan" aria-current="page">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jlduan/Human_blastoid">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>